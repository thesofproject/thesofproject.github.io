<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="710px" preserveAspectRatio="none" style="width:845px;height:710px;" version="1.1" viewBox="0 0 845 710" width="845px" zoomAndPan="magnify"><defs><filter height="300%" id="fbbx2ms8e6sdz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#90EE90" height="688.9922" style="stroke: #A1A1CA; stroke-width: 1.0;" width="64" x="8" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="26.5" y="17.4951">Host</text><rect fill="#ADD8E6" height="688.9922" style="stroke: #A1A1CA; stroke-width: 1.0;" width="521" x="208.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="455.5" y="17.4951">SOF</text><rect fill="#FFFFE0" height="688.9922" style="stroke: #A1A1CA; stroke-width: 1.0;" width="90" x="739.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="742.5" y="17.4951">ACE Platform</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="587.6797" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="258" y="93.3125"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="526.9766" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="438" y="123.6641"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="640" y="213.7188"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="30.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="779.5" y="383.4766"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="30.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="779.5" y="523.2344"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="462.5" x="372" y="342.7734"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="462.5" x="372" y="482.5313"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="40" x2="40" y1="60.9609" y2="698.9922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="262.5" x2="262.5" y1="60.9609" y2="698.9922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="443" x2="443" y1="60.9609" y2="698.9922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="644.5" x2="644.5" y1="60.9609" y2="698.9922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="784.5" x2="784.5" y1="60.9609" y2="698.9922"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="52" x="12" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="19" y="45.8848">Driver</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="97" x="212.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="219.5" y="45.8848">IPC4 Handler</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="118" x="382" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="389" y="45.8848">Library Manager</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="157" x="564.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="571.5" y="45.8848">MPP Memory Manager</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="76" x="744.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="751.5" y="45.8848">ROM EXT</text><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="587.6797" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="258" y="93.3125"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="526.9766" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="438" y="123.6641"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="640" y="213.7188"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="30.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="779.5" y="383.4766"/><rect fill="#FFFFFF" filter="url(#fbbx2ms8e6sdz)" height="30.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="779.5" y="523.2344"/><polygon fill="#F05772" points="246,89.3125,256,93.3125,246,97.3125,250,93.3125" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="40" x2="252" y1="93.3125" y2="93.3125"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="47" y="88.4561">SOF_IPC4_GLB_LOAD_LIBRARY</text><polygon fill="#F05772" points="426,119.6641,436,123.6641,426,127.6641,430,123.6641" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="268" x2="432" y1="123.6641" y2="123.6641"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="275" y="118.8076">lib_manager_load_library()</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="490" y1="170.3672" y2="170.3672"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="490" x2="490" y1="170.3672" y2="183.3672"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="449" x2="490" y1="183.3672" y2="183.3672"/><polygon fill="#F05772" points="459,179.3672,449,183.3672,459,187.3672,455,183.3672" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="455" y="149.1592">Parse Manifest</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="455" y="165.5107">Prepare Storage Memory</text><polygon fill="#F05772" points="628,209.7188,638,213.7188,628,217.7188,632,213.7188" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="634" y1="213.7188" y2="213.7188"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="455" y="208.8623">Allocate L3 memory for library</text><polygon fill="#F05772" points="459,223.7188,449,227.7188,459,231.7188,455,227.7188" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="453" x2="644" y1="227.7188" y2="227.7188"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="490" y1="258.0703" y2="258.0703"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="490" x2="490" y1="258.0703" y2="271.0703"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="449" x2="490" y1="271.0703" y2="271.0703"/><polygon fill="#F05772" points="459,267.0703,449,271.0703,459,275.0703,455,271.0703" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="455" y="253.2139">Prepare HDA DMA transfer</text><polygon fill="#F05772" points="426,318.7734,436,322.7734,426,326.7734,430,322.7734" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="40" x2="432" y1="322.7734" y2="322.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="47" y="301.5654">Transfer library manifest over DMA</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="47" y="317.917">to L3 memory</text><path d="M453,284.0703 L453,326.0703 L679,326.0703 L679,294.0703 L669,284.0703 L453,284.0703 " fill="#F6ED80" filter="url(#fbbx2ms8e6sdz)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M669,284.0703 L669,294.0703 L679,294.0703 L669,284.0703 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="459" y="302.5654">if SoC does not support L3 memory</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="459" y="318.917">then L2 memory has to be used</text><path d="M372,342.7734 L437,342.7734 L437,350.7734 L427,360.7734 L372,360.7734 L372,342.7734 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="462.5" x="372" y="342.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="387" y="357.2686">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="452" y="356.1924">[if AUTH_API_ENABLED]</text><polygon fill="#F05772" points="767.5,379.4766,777.5,383.4766,767.5,387.4766,771.5,383.4766" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="773.5" y1="383.4766" y2="383.4766"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="455" y="378.6201">Verify Manifest</text><polygon fill="#F05772" points="459,409.8281,449,413.8281,459,417.8281,455,413.8281" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="453" x2="783.5" y1="413.8281" y2="413.8281"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="465" y="408.9717">result</text><polygon fill="#F05772" points="426,463.5313,436,467.5313,426,471.5313,430,467.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="40" x2="432" y1="467.5313" y2="467.5313"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="47" y="446.3232">Transfer library code over DMA</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="47" y="462.6748">to L3 memory</text><path d="M372,482.5313 L437,482.5313 L437,490.5313 L427,500.5313 L372,500.5313 L372,482.5313 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="462.5" x="372" y="482.5313"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="387" y="497.0264">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="452" y="495.9502">[if AUTH_API_ENABLED]</text><polygon fill="#F05772" points="767.5,519.2344,777.5,523.2344,767.5,527.2344,771.5,523.2344" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="773.5" y1="523.2344" y2="523.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="455" y="518.3779">Verify whole Library</text><polygon fill="#F05772" points="459,549.5859,449,553.5859,459,557.5859,455,553.5859" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="453" x2="783.5" y1="553.5859" y2="553.5859"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="465" y="548.7295">result</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="490" y1="607.2891" y2="607.2891"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="490" x2="490" y1="607.2891" y2="620.2891"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="449" x2="490" y1="620.2891" y2="620.2891"/><polygon fill="#F05772" points="459,616.2891,449,620.2891,459,624.2891,455,620.2891" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="455" y="586.0811">Update Library</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="455" y="602.4326">descriptors table</text><polygon fill="#F05772" points="279,646.6406,269,650.6406,279,654.6406,275,650.6406" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="273" x2="442" y1="650.6406" y2="650.6406"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="285" y="645.7842">return status</text><polygon fill="#F05772" points="51,676.9922,41,680.9922,51,684.9922,47,680.9922" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="45" x2="262" y1="680.9922" y2="680.9922"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="57" y="676.1357">Complete IPC request</text><!--MD5=[67e7426067632f59a2fa881ed632e032]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "Host" #LightGreen
	participant "Driver" as host_driver
end box

box "SOF" #LightBlue
	participant "IPC4 Handler" as ipc4_handler
	participant "Library Manager" as library_manager
	participant "MPP Memory Manager" as mpp_memory_manager
end box

box "ACE Platform" #LightYellow
	participant "ROM EXT" as rom_ext
end box


host_driver -> ipc4_handler: SOF_IPC4_GLB_LOAD_LIBRARY
	activate ipc4_handler
	ipc4_handler -> library_manager: lib_manager_load_library()
	activate library_manager
	library_manager -> library_manager: Parse Manifest \nPrepare Storage Memory
	library_manager -> mpp_memory_manager: Allocate L3 memory for library
	activate mpp_memory_manager
	mpp_memory_manager -> library_manager
	deactivate mpp_memory_manager
	library_manager -> library_manager: Prepare HDA DMA transfer
	host_driver -> library_manager: Transfer library manifest over DMA\nto L3 memory
	note right: if SoC does not support L3 memory\nthen L2 memory has to be used
	opt if AUTH_API_ENABLED
		library_manager -> rom_ext: Verify Manifest
		activate rom_ext
		rom_ext -> library_manager: result
		deactivate rom_ext
	end opt
	host_driver -> library_manager: Transfer library code over DMA\nto L3 memory
	opt if AUTH_API_ENABLED
		library_manager -> rom_ext: Verify whole Library
		activate rom_ext
		rom_ext -> library_manager: result
		deactivate rom_ext
	end opt
	library_manager -> library_manager: Update Library \ndescriptors table
	library_manager -> ipc4_handler: return status
	deactivate library_manager
ipc4_handler -> host_driver: Complete IPC request
deactivate ipc4_handler

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>