<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="581px" preserveAspectRatio="none" style="width:936px;height:581px;" version="1.1" viewBox="0 0 936 581" width="936px" zoomAndPan="magnify"><defs><filter height="300%" id="f1gquhwdbwxndk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="559.5547" style="stroke: #A1A1CA; stroke-width: 1.0;" width="605.5" x="29" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="318.25" y="17.4951">SOF</text><rect fill="#90EE90" height="559.5547" style="stroke: #A1A1CA; stroke-width: 1.0;" width="132" x="777" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="812" y="17.4951">Hardware</text><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="116.4063" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="98" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="425.8906" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="373" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="378" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="209.5938" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="564" y="334.9609"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="474.5938" style="stroke: #A1A1CA; stroke-width: 2.0;" width="912" x="13" y="77.9609"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="94.8906" style="stroke: #A1A1CA; stroke-width: 2.0;" width="447.5" x="23" y="194.3672"/><rect fill="#FFFFFF" height="46.1875" style="stroke: none; stroke-width: 1.0;" width="447.5" x="23" y="243.0703"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="181.5938" style="stroke: #A1A1CA; stroke-width: 2.0;" width="417.5" x="497.5" y="349.9609"/><rect fill="#FFFFFF" height="89.5391" style="stroke: none; stroke-width: 1.0;" width="417.5" x="497.5" y="442.0156"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="103" x2="103" y1="60.9609" y2="569.5547"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="377.5" x2="377.5" y1="60.9609" y2="569.5547"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="568.5" x2="568.5" y1="60.9609" y2="569.5547"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="843" x2="843" y1="60.9609" y2="569.5547"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="136" x="33" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="40" y="45.8848">Core #N: Zephyr lib</text><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="161" x="295.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="302.5" y="45.8848">Zephyr Power Manager</text><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="119" x="507.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="514.5" y="45.8848">Zephyr SoC HAL</text><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="120" x="781" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="788" y="45.8848">Core #N: Control</text><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="116.4063" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="98" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="425.8906" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="373" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="378" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f1gquhwdbwxndk)" height="209.5938" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="564" y="334.9609"/><path d="M13,77.9609 L78,77.9609 L78,85.9609 L68,95.9609 L13,95.9609 L13,77.9609 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="474.5938" style="stroke: #A1A1CA; stroke-width: 2.0;" width="912" x="13" y="77.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="28" y="92.4561">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="93" y="91.3799">[When Core is Idle]</text><polygon fill="#F05772" points="119,114.6641,109,118.6641,119,122.6641,115,118.6641" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="113" x2="372" y1="118.6641" y2="118.6641"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="125" y="113.8076">pm_policy_next_state (PID: Core #N, ticks)</text><polygon fill="#F05772" points="366,161.3672,376,165.3672,366,169.3672,370,165.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108" x2="372" y1="165.3672" y2="165.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="115" y="144.1592">pm_policy_state_lock_get</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="115" y="160.5107">(PM_STATE_RUNTIME_IDLE)</text><polygon fill="#F05772" points="119,175.3672,109,179.3672,119,183.3672,115,179.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="113" x2="372" y1="179.3672" y2="179.3672"/><path d="M23,194.3672 L84,194.3672 L84,202.3672 L74,212.3672 L23,212.3672 L23,194.3672 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="94.8906" style="stroke: #A1A1CA; stroke-width: 2.0;" width="447.5" x="23" y="194.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="38" y="208.8623">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="99" y="207.7861">[if no lock on D0ix state]</text><polygon fill="#F05772" points="361,231.0703,371,235.0703,361,239.0703,365,235.0703" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="103" x2="367" y1="235.0703" y2="235.0703"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="110" y="230.2139">PM_STATE_RUNTIME_IDLE</text><line style="stroke: #A1A1CA; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="470.5" y1="244.0703" y2="244.0703"/><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="28" y="255.4893">[if there is lock on D0ix state]</text><polygon fill="#F05772" points="361,277.2578,371,281.2578,361,285.2578,365,281.2578" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="103" x2="367" y1="281.2578" y2="281.2578"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="110" y="276.4014">PM_STATE_ACTIVE</text><polygon fill="#F05772" points="552,330.9609,562,334.9609,552,338.9609,556,334.9609" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="383" x2="558" y1="334.9609" y2="334.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="390" y="313.7529">pm_power_state_set</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="390" y="330.1045">(power_state, PID: Core #N)</text><path d="M497.5,349.9609 L558.5,349.9609 L558.5,357.9609 L548.5,367.9609 L497.5,367.9609 L497.5,349.9609 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="181.5938" style="stroke: #A1A1CA; stroke-width: 2.0;" width="417.5" x="497.5" y="349.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="512.5" y="364.4561">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="573.5" y="363.3799">[If power_state is PM_STATE_IDLE]</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="574" x2="616" y1="390.6641" y2="390.6641"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="616" x2="616" y1="390.6641" y2="403.6641"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="575" x2="616" y1="403.6641" y2="403.6641"/><polygon fill="#F05772" points="585,399.6641,575,403.6641,585,407.6641,581,403.6641" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="581" y="385.8076">arch_clear_power_gating_prevent (Core #N)</text><polygon fill="#F05772" points="831,430.0156,841,434.0156,831,438.0156,835,434.0156" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="574" x2="837" y1="434.0156" y2="434.0156"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="581" y="429.1592">Clear power gating prevent</text><line style="stroke: #A1A1CA; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="497.5" x2="915" y1="443.0156" y2="443.0156"/><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="502.5" y="454.4346">[if PM_STATE_RUNTIME_ACTIVE]</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="574" x2="616" y1="480.2031" y2="480.2031"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="616" x2="616" y1="480.2031" y2="493.2031"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="575" x2="616" y1="493.2031" y2="493.2031"/><polygon fill="#F05772" points="585,489.2031,575,493.2031,585,497.2031,581,493.2031" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="581" y="475.3467">arch_set_power_gating_prevent (Core #N)</text><polygon fill="#F05772" points="831,519.5547,841,523.5547,831,527.5547,835,523.5547" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="574" x2="837" y1="523.5547" y2="523.5547"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="581" y="518.6982">Set power gating prevent</text><polygon fill="#F05772" points="389,540.5547,379,544.5547,389,548.5547,385,544.5547" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="383" x2="568" y1="544.5547" y2="544.5547"/><!--MD5=[c6bc4753e2cf8431f0570740591a14a1]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "SOF" #LightBlue
	participant "Core #N: Zephyr lib" as sof_zephyr_lib
	participant "Zephyr Power Manager" as zephyr_power_manager
	participant "Zephyr SoC HAL" as soc_hal
end box

box "Hardware" #LightGreen
	participant "Core #N: Control" as core_hw_control
end box

opt When Core is Idle

	zephyr_power_manager -> sof_zephyr_lib: pm_policy_next_state (PID: Core #N, ticks)
	activate sof_zephyr_lib
		activate zephyr_power_manager
		sof_zephyr_lib -> zephyr_power_manager: pm_policy_state_lock_get\n(PM_STATE_RUNTIME_IDLE)
		activate zephyr_power_manager
		return
		alt if no lock on D0ix state
			return PM_STATE_RUNTIME_IDLE
		else if there is lock on D0ix state
			return PM_STATE_ACTIVE
		end

	zephyr_power_manager -> soc_hal: pm_power_state_set\n(power_state, PID: Core #N)
	activate soc_hal
	alt If power_state is PM_STATE_IDLE
		soc_hal -> soc_hal: arch_clear_power_gating_prevent (Core #N)
		soc_hal -> core_hw_control: Clear power gating prevent
	else if PM_STATE_RUNTIME_ACTIVE
		soc_hal -> soc_hal: arch_set_power_gating_prevent (Core #N)
		soc_hal -> core_hw_control: Set power gating prevent
	end
	return

	deactivate zephyr_power_manager
end

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>