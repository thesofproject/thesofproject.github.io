<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1577px" preserveAspectRatio="none" style="width:1526px;height:1577px;" version="1.1" viewBox="0 0 1526 1577" width="1526px" zoomAndPan="magnify"><defs><filter height="300%" id="fe4q9kc618p87" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFF0F5" height="1555.8125" style="stroke: #A1A1CA; stroke-width: 1.0;" width="470.5" x="27" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="173.75" y="16.0669">Linux User/Kernel space</text><rect fill="#ADD8E6" height="1555.8125" style="stroke: #A1A1CA; stroke-width: 1.0;" width="746" x="763.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="1121.5" y="16.0669">DSP</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="1434.1172" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="830" y="68.4297"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="89.5313" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1027" y="991.2891"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1027" y="1234.4844"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="290.9375" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1225" y="570.8203"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="960.8594" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1421.5" y="541.6875"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="119.6641" style="stroke: #A1A1CA; stroke-width: 2.0;" width="1326.5" x="21" y="222.2266"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="41.7422" style="stroke: #A1A1CA; stroke-width: 2.0;" width="403" x="1112.5" y="729.6172"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="103.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="1494.5" x="21" y="1182.2188"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="119" x2="119" y1="58.4297" y2="1565.8125"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="443.5" x2="443.5" y1="58.4297" y2="1565.8125"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="834.5" x2="834.5" y1="58.4297" y2="1565.8125"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1031.5" x2="1031.5" y1="58.4297" y2="1565.8125"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1229.5" x2="1229.5" y1="58.4297" y2="1565.8125"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1426.5" x2="1426.5" y1="58.4297" y2="1565.8125"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="172" x="31" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="38" y="43.1279">Userspace component</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="95" x="394.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="401.5" y="43.1279">Audio driver</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="131" x="767.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="774.5" y="43.1279">FW infrastructure</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="157" x="951.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="958.5" y="43.1279">Data transfer to Host</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="211" x="1122.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197" x="1129.5" y="43.1279">Keyword detection algorithm</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="154" x="1347.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="1354.5" y="43.1279">Data transfer to DSP</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="1434.1172" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="830" y="68.4297"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="89.5313" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1027" y="991.2891"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1027" y="1234.4844"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="290.9375" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1225" y="570.8203"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="960.8594" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="1421.5" y="541.6875"/><polygon fill="#4A4A86" points="818,100.6953,828,104.6953,818,108.6953,822,104.6953" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="104.6953" y2="104.6953"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="451" y="84.4966">Setup audio topology</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="455" y="99.6294">(Speech Capture &amp; Keyword Detection pipes)</text><polygon fill="#4A4A86" points="432,144.9609,442,148.9609,432,152.9609,436,148.9609" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="148.9609" y2="148.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="126" y="128.7622">Prepare &amp; Open PCM capture</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="126" y="143.895">(snd_pcm_open/snd_pcm_hw_params)</text><polygon fill="#4A4A86" points="818,174.0938,828,178.0938,818,182.0938,822,178.0938" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="178.0938" y2="178.0938"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="451" y="173.0278">Stream Open &amp; Preparation</text><polygon fill="#4A4A86" points="818,203.2266,828,207.2266,818,211.2266,822,207.2266" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="207.2266" y2="207.2266"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="451" y="202.1606">HW Params</text><path d="M21,222.2266 L571,222.2266 L571,229.2266 L561,239.2266 L21,239.2266 L21,222.2266 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="119.6641" style="stroke: #A1A1CA; stroke-width: 2.0;" width="1326.5" x="21" y="222.2266"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="505" x="36" y="235.2935">optional (depends on keyword detection algorithm implementation)</text><polygon fill="#4A4A86" points="432,271.625,442,275.625,432,279.625,436,275.625" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="275.625" y2="275.625"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="126" y="255.4263">Send keyword detection algorithm parameters</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="130" y="270.5591">(snd_ctl_elem_tlv_write)</text><polygon fill="#4A4A86" points="818,300.7578,828,304.7578,818,308.7578,822,304.7578" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="304.7578" y2="304.7578"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="451" y="299.6919">Send keyword detection algorithm parameters</text><polygon fill="#4A4A86" points="1218,329.8906,1228,333.8906,1218,337.8906,1222,333.8906" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="1224" y1="333.8906" y2="333.8906"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="847" y="328.8247">Send keyword detection algorithm parameters</text><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="486" y1="370.0234" y2="370.0234"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="486" x2="486" y1="370.0234" y2="383.0234"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="445" x2="486" y1="383.0234" y2="383.0234"/><polygon fill="#4A4A86" points="455,379.0234,445,383.0234,455,387.0234,451,383.0234" style="stroke: #4A4A86; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="451" y="364.9575">DAPM power up event</text><polygon fill="#4A4A86" points="818,408.1563,828,412.1563,818,416.1563,822,412.1563" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="412.1563" y2="412.1563"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="451" y="407.0903">HW Params for Keyphrase Detection Pipeline</text><polygon fill="#4A4A86" points="432,437.2891,442,441.2891,432,445.2891,436,441.2891" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="441.2891" y2="441.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="126" y="436.2231">Trigger start (alsamixer)</text><polygon fill="#4A4A86" points="818,466.4219,828,470.4219,818,474.4219,822,470.4219" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="470.4219" y2="470.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="451" y="465.356">Keyword detection algorithm &amp; buffer manager triggered</text><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="882" y1="514.6875" y2="514.6875"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="882" x2="882" y1="514.6875" y2="527.6875"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="841" x2="882" y1="527.6875" y2="527.6875"/><polygon fill="#4A4A86" points="851,523.6875,841,527.6875,851,531.6875,847,527.6875" style="stroke: #4A4A86; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="847" y="494.4888">Keyphrase Buffer Manager</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="847" y="509.6216">in acquisition mode</text><polygon fill="#4A4A86" points="1409.5,537.6875,1419.5,541.6875,1409.5,545.6875,1413.5,541.6875" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="1415.5" y1="541.6875" y2="541.6875"/><polygon fill="#4A4A86" points="1213,566.8203,1223,570.8203,1213,574.8203,1217,570.8203" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="1219" y1="570.8203" y2="570.8203"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="847" y="565.7544">keypharse detection enabled</text><polygon fill="#4A4A86" points="432,595.9531,442,599.9531,432,603.9531,436,599.9531" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="599.9531" y2="599.9531"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="126" y="594.8872">Trigger start (snd_pcm_read)</text><path d="M8,612.9531 L8,652.9531 L226,652.9531 L226,622.9531 L216,612.9531 L8,612.9531 " fill="#F6ED80" filter="url(#fe4q9kc618p87)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M216,612.9531 L216,622.9531 L226,622.9531 L216,612.9531 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="14" y="630.02">Speech application indefinitely</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="14" y="645.1528">waits for data.</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1476.5" x="28" y="662.2188"/><polygon fill="#EEEEEE" points="28,662.2188,94,662.2188,94,669.2188,84,679.2188,28,679.2188,28,662.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="41" y="676.2856">ref</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="562.25" y="695.2856">Speech Capture pipeline is not transmitting data to Host system</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="562.25" y="710.4185">Host system may enter the low power state</text><path d="M1112.5,729.6172 L1189.5,729.6172 L1189.5,736.6172 L1179.5,746.6172 L1112.5,746.6172 L1112.5,729.6172 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="41.7422" style="stroke: #A1A1CA; stroke-width: 2.0;" width="403" x="1112.5" y="729.6172"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="1127.5" y="742.6841">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="1204.5" y="741.8276">[keyword detection algorithm</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="1204.5" y="754.6323">executed on DSP]</text><polygon fill="#4A4A86" points="1246,759.3594,1236,763.3594,1246,767.3594,1242,763.3594" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="1240" x2="1420.5" y1="763.3594" y2="763.3594"/><polygon fill="#F6ED80" filter="url(#fe4q9kc618p87)" points="1164,783.3594,1295,783.3594,1305,794.3594,1295,806.3594,1164,806.3594,1154,794.3594,1164,783.3594" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1166" y="799.4263">keyword is detected</text><polygon fill="#4A4A86" points="851,828.625,841,832.625,851,836.625,847,832.625" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="845" x2="1224" y1="832.625" y2="832.625"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="857" y="827.5591">FW event on keyword detection</text><polygon fill="#4A4A86" points="1218,857.7578,1228,861.7578,1218,865.7578,1222,861.7578" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="1224" y1="861.7578" y2="861.7578"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="847" y="856.6919">keyword detection disabled</text><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="882" y1="906.0234" y2="906.0234"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="882" x2="882" y1="906.0234" y2="919.0234"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="841" x2="882" y1="919.0234" y2="919.0234"/><polygon fill="#4A4A86" points="851,915.0234,841,919.0234,851,923.0234,847,919.0234" style="stroke: #4A4A86; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="847" y="885.8247">Keyphrase Buffer Manager</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="847" y="900.9575">in drain mode</text><polygon fill="#4A4A86" points="455,944.1563,445,948.1563,455,952.1563,451,948.1563" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="449" x2="829" y1="948.1563" y2="948.1563"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="461" y="943.0903">notification on keyword detection</text><polygon fill="#4A4A86" points="130,973.2891,120,977.2891,130,981.2891,126,977.2891" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="124" x2="443" y1="977.2891" y2="977.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="136" y="972.2231">notification on keyword detection (optional)</text><polygon fill="#4A4A86" points="1048,987.2891,1038,991.2891,1048,995.2891,1044,991.2891" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="1042" x2="1420.5" y1="991.2891" y2="991.2891"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="70.5313" style="stroke: #000000; stroke-width: 2.0;" width="289" x="948.5" y="999.2891"/><polygon fill="#EEEEEE" points="948.5,999.2891,1014.5,999.2891,1014.5,1006.2891,1004.5,1016.2891,948.5,1016.2891,948.5,999.2891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="961.5" y="1013.356">ref</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="954.5" y="1032.356">Sending a burst of historic data (approx.2s)</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="954.5" y="1047.4888">with detected keyword for</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="954.5" y="1062.6216">second stage verification on host.</text><polygon fill="#4A4A86" points="1409.5,1076.8203,1419.5,1080.8203,1409.5,1084.8203,1413.5,1080.8203" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1032" x2="1415.5" y1="1080.8203" y2="1080.8203"/><polygon fill="#4A4A86" points="130,1105.9531,120,1109.9531,130,1113.9531,126,1109.9531" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="124" x2="443" y1="1109.9531" y2="1109.9531"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="136" y="1104.8872">snd_pcm_read completed</text><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="840" x2="882" y1="1154.2188" y2="1154.2188"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="882" x2="882" y1="1154.2188" y2="1167.2188"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="841" x2="882" y1="1167.2188" y2="1167.2188"/><polygon fill="#4A4A86" points="851,1163.2188,841,1167.2188,851,1171.2188,847,1167.2188" style="stroke: #4A4A86; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="847" y="1134.02">Keyphrase Buffer Manager</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="847" y="1149.1528">in passthrough mode</text><path d="M21,1182.2188 L98,1182.2188 L98,1189.2188 L88,1199.2188 L21,1199.2188 L21,1182.2188 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="103.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="1494.5" x="21" y="1182.2188"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="36" y="1195.2856">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="113" y="1194.4292">[Realtime capture]</text><polygon fill="#4A4A86" points="432,1216.4844,442,1220.4844,432,1224.4844,436,1220.4844" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="1220.4844" y2="1220.4844"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="126" y="1215.4185">snd_pcm_read</text><polygon fill="#4A4A86" points="1048,1230.4844,1038,1234.4844,1048,1238.4844,1044,1234.4844" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="1042" x2="1420.5" y1="1234.4844" y2="1234.4844"/><polygon fill="#4A4A86" points="1409.5,1244.4844,1419.5,1248.4844,1409.5,1252.4844,1413.5,1248.4844" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1032" x2="1415.5" y1="1248.4844" y2="1248.4844"/><polygon fill="#4A4A86" points="130,1273.6172,120,1277.6172,130,1281.6172,126,1277.6172" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="124" x2="443" y1="1277.6172" y2="1277.6172"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="136" y="1272.5513">snd_pcm_read completed</text><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="430" x="28" y="1292.6172"/><polygon fill="#EEEEEE" points="28,1292.6172,94,1292.6172,94,1299.6172,84,1309.6172,28,1309.6172,28,1292.6172" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="41" y="1306.6841">ref</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="34" y="1325.6841">User space optionally performs second stage keyword verification.</text><polygon fill="#4A4A86" points="432,1355.0156,442,1359.0156,432,1363.0156,436,1359.0156" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="1359.0156" y2="1359.0156"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="126" y="1353.9497">Trigger stop (alsamixer)</text><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="486" y1="1388.1484" y2="1388.1484"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="486" x2="486" y1="1388.1484" y2="1401.1484"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="445" x2="486" y1="1401.1484" y2="1401.1484"/><polygon fill="#4A4A86" points="455,1397.1484,445,1401.1484,455,1405.1484,451,1401.1484" style="stroke: #4A4A86; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="451" y="1383.0825">DAPM power down event</text><polygon fill="#4A4A86" points="818,1426.2813,828,1430.2813,818,1434.2813,822,1430.2813" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="1430.2813" y2="1430.2813"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="451" y="1425.2153">Stop Keyphrase Detection algorithm pipeline</text><polygon fill="#4A4A86" points="432,1455.4141,442,1459.4141,432,1463.4141,436,1459.4141" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="119" x2="438" y1="1459.4141" y2="1459.4141"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="126" y="1454.3481">Trigger stop (snd_pcm_drop / snd_pcm_free)</text><polygon fill="#4A4A86" points="818,1484.5469,828,1488.5469,818,1492.5469,822,1488.5469" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="444" x2="824" y1="1488.5469" y2="1488.5469"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="451" y="1483.481">Close Speech capture stream</text><polygon fill="#4A4A86" points="1414.5,1498.5469,1424.5,1502.5469,1414.5,1506.5469,1418.5,1502.5469" style="stroke: #4A4A86; stroke-width: 1.0;"/><line style="stroke: #4A4A86; stroke-width: 1.0;" x1="835" x2="1420.5" y1="1502.5469" y2="1502.5469"/><rect fill="#FFFFFF" filter="url(#fe4q9kc618p87)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="1476.5" x="28" y="1510.5469"/><polygon fill="#EEEEEE" points="28,1510.5469,94,1510.5469,94,1517.5469,84,1527.5469,28,1527.5469,28,1510.5469" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="41" y="1524.6138">ref</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="512.25" y="1543.6138">The flow can be repeated for next user command starting from snd_pcm_open()</text><!--
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}
participant "Userspace component" as usr
participant "Audio driver" as drv
participant "FW infrastructure" as fw
participant "Data transfer to Host" as dma
participant "Keyword detection algorithm" as kda
participant "Data transfer to DSP" as gpdma

box "Linux User/Kernel space" #LavenderBlush
	participant usr
	participant drv
end box

box "DSP" #LightBlue
	participant fw
	participant dma
	participant kda
	participant gpdma
end box

activate fw

drv -> fw : Setup audio topology \n (Speech Capture & Keyword Detection pipes)
usr -> drv : Prepare & Open PCM capture \n(snd_pcm_open/snd_pcm_hw_params)
drv -> fw : Stream Open & Preparation
drv -> fw : HW Params
group optional (depends on keyword detection algorithm implementation)
 usr -> drv : Send keyword detection algorithm parameters \n (snd_ctl_elem_tlv_write)
 drv -> fw : Send keyword detection algorithm parameters
 fw -> kda : Send keyword detection algorithm parameters
end

drv ->drv : DAPM power up event
drv -> fw : HW Params for Keyphrase Detection Pipeline
usr -> drv : Trigger start (alsamixer)
drv -> fw : Keyword detection algorithm & buffer manager triggered

fw -> fw : Keyphrase Buffer Manager \nin acquisition mode
fw -> gpdma 

activate gpdma

fw -> kda : keypharse detection enabled

activate kda

usr -> drv : Trigger start (snd_pcm_read)

note over usr
Speech application indefinitely 
waits for data.
end note 

ref over usr, drv, fw , gpdma, kda, dma  
Speech Capture pipeline is not transmitting data to Host system
Host system may enter the low power state
end ref

loop keyword detection algorithm \nexecuted on DSP
 kda <- gpdma 
end

hnote over kda : keyword is detected

fw <- - kda : FW event on keyword detection
fw -> kda : keyword detection disabled

deactivate kda 

fw -> fw : Keyphrase Buffer Manager \nin drain mode
drv <- - fw : notification on keyword detection
usr <- - drv : notification on keyword detection (optional)
gpdma -> dma 

activate dma

ref over dma 
Sending a burst of historic data (approx.2s) 
with detected keyword for
second stage verification on host.
end ref

gpdma <- - dma 

deactivate dma

usr <- - drv : snd_pcm_read completed 

fw -> fw : Keyphrase Buffer Manager \nin passthrough mode 

loop Realtime capture
 usr -> drv : snd_pcm_read
 gpdma -> dma 
 activate dma
 gpdma <- - dma 

 deactivate dma
 usr <- - drv : snd_pcm_read completed 
end 

ref over usr 
User space optionally performs second stage keyword verification.
end ref

usr -> drv : Trigger stop (alsamixer)
drv ->drv : DAPM power down event
drv -> fw : Stop Keyphrase Detection algorithm pipeline
usr -> drv : Trigger stop (snd_pcm_drop / snd_pcm_free)
drv -> fw : Close Speech capture stream
fw -> gpdma 

deactivate gpdma

ref over usr, drv, fw , gpdma, kda, dma  
The flow can be repeated for next user command starting from snd_pcm_open()
end ref

deactivate fw
@enduml

PlantUML version 1.2019.06(Fri May 24 17:10:25 UTC 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.2+9
Operating System: Linux
OS Version: 4.15.0-1028-gcp
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>