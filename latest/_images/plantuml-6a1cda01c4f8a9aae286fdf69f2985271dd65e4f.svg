<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="482px" preserveAspectRatio="none" style="width:1000px;height:482px;" version="1.1" viewBox="0 0 1000 482" width="1000px" zoomAndPan="magnify"><defs><filter height="300%" id="fab77ccyncees" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="460.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="179" x="33.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="108.5" y="16.0669">SOF</text><rect fill="#90EE90" height="460.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="367" x="222.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="380" y="16.0669">Zephyr</text><rect fill="#D3D3D3" height="460.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="81" x="820" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="824.5" y="16.0669">Hardware</text><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="154.6641" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="118" y="305.625"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="290" y="431.2891"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="194.9297" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="474.5" y="89.5625"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="58.2656" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="479.5" y="211.2266"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="46.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="543.5" x="363.5" y="231.2266"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="346" x="27.5" y="377.8906"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="122.5" x2="122.5" y1="58.4297" y2="470.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="294.5" x2="294.5" y1="58.4297" y2="470.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="479.5" x2="479.5" y1="58.4297" y2="470.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="860" x2="860" y1="58.4297" y2="470.2891"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="167" x="37.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="44.5" y="43.1279">MPP Memory Manager</text><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="133" x="226.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="233.5" y="43.1279">Memory Manager</text><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="208" x="373.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="194" x="380.5" y="43.1279">Memory Management Driver</text><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="69" x="824" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="831" y="43.1279">Memory</text><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="154.6641" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="118" y="305.625"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="290" y="431.2891"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="194.9297" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="474.5" y="89.5625"/><rect fill="#FFFFFF" filter="url(#fab77ccyncees)" height="58.2656" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="479.5" y="211.2266"/><polygon fill="#F05772" points="462.5,85.5625,472.5,89.5625,462.5,93.5625,466.5,89.5625" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="3" x2="468.5" y1="89.5625" y2="89.5625"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="10" y="84.4966">sys_mm_drv_mm_init</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="484.5" x2="526.5" y1="139.8945" y2="139.8945"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="526.5" x2="526.5" y1="139.8945" y2="152.8945"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="485.5" x2="526.5" y1="152.8945" y2="152.8945"/><polygon fill="#F05772" points="495.5,148.8945,485.5,152.8945,495.5,156.8945,491.5,152.8945" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="491.5" y="119.6958">read unused_main_mem_start_marker</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="491.5" y="134.8286">from linker</text><path d="M753,102.5625 L753,157.5625 L988,157.5625 L988,112.5625 L978,102.5625 L753,102.5625 " fill="#F6ED80" filter="url(#fab77ccyncees)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M978,102.5625 L978,112.5625 L988,112.5625 L978,102.5625 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="759" y="119.6294">The marker is used to</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="763" y="134.7622">identify where base firmware</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="763" y="149.895">ends in memory (text, data, bss)</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="484.5" x2="531.5" y1="198.2266" y2="198.2266"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="531.5" x2="531.5" y1="198.2266" y2="211.2266"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="490.5" x2="531.5" y1="211.2266" y2="211.2266"/><polygon fill="#F05772" points="500.5,207.2266,490.5,211.2266,500.5,215.2266,496.5,211.2266" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="496.5" y="178.0278">sys_mm_drv_unmap_region(unused_main_mem_start,</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="496.5" y="193.1606">unused_size)</text><path d="M363.5,231.2266 L433.5,231.2266 L433.5,238.2266 L423.5,248.2266 L363.5,248.2266 L363.5,231.2266 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="46.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="543.5" x="363.5" y="231.2266"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="378.5" y="244.2935">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="401" x="448.5" y="243.437">[If architecture support granular memory banks power control]</text><polygon fill="#F05772" points="848.5,265.4922,858.5,269.4922,848.5,273.4922,852.5,269.4922" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="484.5" x2="854.5" y1="269.4922" y2="269.4922"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="491.5" y="264.4263">power down unused memory banks</text><polygon fill="#F05772" points="106,301.625,116,305.625,106,309.625,110,305.625" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="3" x2="112" y1="305.625" y2="305.625"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="10" y="300.5591">mpp_mem_init</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="128" x2="170" y1="349.8906" y2="349.8906"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="170" x2="170" y1="349.8906" y2="362.8906"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="129" x2="170" y1="362.8906" y2="362.8906"/><polygon fill="#F05772" points="139,358.8906,129,362.8906,139,366.8906,135,362.8906" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="135" y="329.6919">read memory zones</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="135" y="344.8247">base address and size</text><path d="M27.5,377.8906 L104.5,377.8906 L104.5,384.8906 L94.5,394.8906 L27.5,394.8906 L27.5,377.8906 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="346" x="27.5" y="377.8906"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="42.5" y="390.9575">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="119.5" y="390.1011">[for each memory region create heap]</text><polygon fill="#F05772" points="278,427.2891,288,431.2891,278,435.2891,282,431.2891" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="128" x2="284" y1="431.2891" y2="431.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="135" y="411.0903">k_heap_init</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="135" y="426.2231">(heap, mem*, size)</text><polygon fill="#F05772" points="139,441.2891,129,445.2891,139,449.2891,135,445.2891" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="133" x2="294" y1="445.2891" y2="445.2891"/><!--MD5=[599701d498a3485dfca1297e027eadc4]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "SOF" #LightBlue
	participant "MPP Memory Manager" as mpp_memory_manager
end box

box "Zephyr" #LightGreen
	participant "Memory Manager" as zephyr_memory_manager
	participant "Memory Management Driver" as memory_management_driver
end box

box "Hardware" #LightGrey
	participant "Memory" as hw_memory
end box


-> memory_management_driver: sys_mm_drv_mm_init
	activate memory_management_driver
	memory_management_driver -> memory_management_driver: read unused_main_mem_start_marker\nfrom linker
	note right: The marker is used to\n identify where base firmware\n ends in memory (text, data, bss)

	memory_management_driver -> memory_management_driver: sys_mm_drv_unmap_region(unused_main_mem_start, unused_size)
		activate memory_management_driver
		opt If architecture support granular memory banks power control
			memory_management_driver -> hw_memory: power down unused memory banks
			deactivate memory_management_driver
		end

	deactivate memory_management_driver

-> mpp_memory_manager: mpp_mem_init
	activate mpp_memory_manager
	mpp_memory_manager -> mpp_memory_manager: read memory zones\nbase address and size
	loop for each memory region create heap
		mpp_memory_manager -> zephyr_memory_manager: k_heap_init\n(heap, mem*, size)
			activate zephyr_memory_manager
			return
	end

	deactivate mpp_memory_manager

@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.23+9
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>