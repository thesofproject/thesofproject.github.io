<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="635px" preserveAspectRatio="none" style="width:1179px;height:635px;" version="1.1" viewBox="0 0 1179 635" width="1179px" zoomAndPan="magnify"><defs><filter height="300%" id="f9wq5xahib35p" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#87CEFA" height="613.9375" style="stroke: #A1A1CA; stroke-width: 1.0;" width="62" x="19" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="36.5" y="17.4951">Host</text><rect fill="#ADD8E6" height="613.9375" style="stroke: #A1A1CA; stroke-width: 1.0;" width="586" x="229.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="509" y="17.4951">SOF</text><rect fill="#90EE90" height="613.9375" style="stroke: #A1A1CA; stroke-width: 1.0;" width="131" x="915.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="950" y="17.4951">Hardware</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="74.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="298" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="330.8672" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="298" y="275.0703"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="130.4063" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="438" y="455.5313"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="591" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="286.5156" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="745" y="305.4219"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="123.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="675.5" x="13" y="77.9609"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="374" x="678.5" y="530.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="50" x2="50" y1="60.9609" y2="623.9375"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="302.5" x2="302.5" y1="60.9609" y2="623.9375"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="442.5" x2="442.5" y1="60.9609" y2="623.9375"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="595.5" x2="595.5" y1="60.9609" y2="623.9375"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="749.5" x2="749.5" y1="60.9609" y2="623.9375"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="980.5" x2="980.5" y1="60.9609" y2="623.9375"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="50" x="23" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="30" y="45.8848">driver</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="135" x="233.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="240.5" y="45.8848">Core #0: Zephyr lib</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="117" x="382.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="389.5" y="45.8848">Core #1: FW Init</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="161" x="513.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="520.5" y="45.8848">Zephyr Power Manager</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="119" x="688.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="695.5" y="45.8848">Zephyr SoC HAL</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="119" x="919.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="926.5" y="45.8848">Core #1: Control</text><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="74.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="298" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="330.8672" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="298" y="275.0703"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="130.4063" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="438" y="455.5313"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="591" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f9wq5xahib35p)" height="286.5156" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="745" y="305.4219"/><path d="M13,77.9609 L78,77.9609 L78,85.9609 L68,95.9609 L13,95.9609 L13,77.9609 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="123.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="675.5" x="13" y="77.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="28" y="92.4561">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="93" y="91.3799">[If D0ix is enabled]</text><polygon fill="#F05772" points="286,114.6641,296,118.6641,286,122.6641,290,118.6641" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="50" x2="292" y1="118.6641" y2="118.6641"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="57" y="113.8076">SET_D0ix(prevent D0/D0ix) IPC request</text><polygon fill="#F05772" points="579,161.3672,589,165.3672,579,169.3672,583,165.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="308" x2="585" y1="165.3672" y2="165.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="315" y="144.1592">pm_policy_state_lock_get</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="315" y="160.5107">(PM_STATE_RUNTIME_IDLE)</text><polygon fill="#F05772" points="319,175.3672,309,179.3672,319,183.3672,315,179.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313" x2="595" y1="179.3672" y2="179.3672"/><polygon fill="#F05772" points="61,189.3672,51,193.3672,61,197.3672,57,193.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="302" y1="193.3672" y2="193.3672"/><rect fill="#EEEEEE" filter="url(#f9wq5xahib35p)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1164" x="3" y="229.543"/><line style="stroke: #D6D6DE; stroke-width: 0.5;" x1="3" x2="1167" y1="229.543" y2="229.543"/><line style="stroke: #D6D6DE; stroke-width: 0.5;" x1="3" x2="1167" y1="232.543" y2="232.543"/><rect fill="#EEEEEE" filter="url(#f9wq5xahib35p)" height="24.3516" style="stroke: #D6D6DE; stroke-width: 1.0;" width="213" x="478.5" y="218.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="484.5" y="235.8623">DSP FW in PM_STATE_ACTIVE</text><polygon fill="#F05772" points="286,271.0703,296,275.0703,286,279.0703,290,275.0703" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="50" x2="292" y1="275.0703" y2="275.0703"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="57" y="270.2139">SET_DX(PID: Core #1, D0) IPC request</text><polygon fill="#F05772" points="733,301.4219,743,305.4219,733,309.4219,737,305.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="308" x2="739" y1="305.4219" y2="305.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="315" y="300.5654">arch_start_cpu(PID: Core #1)</text><polygon fill="#F05772" points="969,361.3008,979,365.3008,969,369.3008,973,365.3008" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="755" x2="975" y1="365.3008" y2="365.3008"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="762" y="360.4443">Set alternate boot vector to FW Init</text><path d="M986,318.4219 L986,393.4219 L1153,393.4219 L1153,328.4219 L1143,318.4219 L986,318.4219 " fill="#F6ED80" filter="url(#f9wq5xahib35p)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M1143,318.4219 L1143,328.4219 L1153,328.4219 L1143,318.4219 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="992" y="336.917">Cores share the</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="992" y="353.2686">same FW binary</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="992" y="369.6201">and the firmware must be</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="992" y="385.9717">present in SRAM.</text><polygon fill="#F05772" points="969,421.1797,979,425.1797,969,429.1797,973,425.1797" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="755" x2="975" y1="425.1797" y2="425.1797"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="762" y="420.3232">Set SPA bit</text><polygon fill="#F05772" points="459,451.5313,449,455.5313,459,459.5313,455,455.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="453" x2="980" y1="455.5313" y2="455.5313"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="465" y="450.6748">Start and jump to alternate boot vector</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="448" x2="490" y1="502.2344" y2="502.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="490" x2="490" y1="502.2344" y2="515.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="449" x2="490" y1="515.2344" y2="515.2344"/><polygon fill="#F05772" points="459,511.2344,449,515.2344,459,519.2344,455,515.2344" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="455" y="481.0264">Restore context</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="455" y="497.3779">if any saved</text><path d="M678.5,530.2344 L751.5,530.2344 L751.5,538.2344 L741.5,548.2344 L678.5,548.2344 L678.5,530.2344 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="374" x="678.5" y="530.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="693.5" y="544.7295">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="766.5" y="543.6533">[Until Core #1 is enabled]</text><polygon fill="#F05772" points="969,566.9375,979,570.9375,969,574.9375,973,570.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="755" x2="975" y1="570.9375" y2="570.9375"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="762" y="566.0811">read power register</text><polygon fill="#F05772" points="319,587.9375,309,591.9375,319,595.9375,315,591.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="313" x2="749" y1="591.9375" y2="591.9375"/><polygon fill="#F05772" points="61,601.9375,51,605.9375,61,609.9375,57,605.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="302" y1="605.9375" y2="605.9375"/><!--MD5=[05215b296a16a4bb4fdf595154f9f8a2]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "Host" #LightSkyBlue
	participant "driver" as driver
end box

box "SOF" #LightBlue
	participant "Core #0: Zephyr lib" as sof_zephyr_lib_0
	participant "Core #1: FW Init" as fw_init_1
	participant "Zephyr Power Manager" as zephyr_power_manager
	participant "Zephyr SoC HAL" as soc_hal
end box

box "Hardware" #LightGreen
	participant "Core #1: Control" as core_control_1
end box

opt If D0ix is enabled
	driver -> sof_zephyr_lib_0: SET_D0ix(prevent D0/D0ix) IPC request
	activate sof_zephyr_lib_0
		sof_zephyr_lib_0 -> zephyr_power_manager: pm_policy_state_lock_get\n(PM_STATE_RUNTIME_IDLE)
		activate zephyr_power_manager
		return
	return
end

== DSP FW in PM_STATE_ACTIVE ==

driver -> sof_zephyr_lib_0: SET_DX(PID: Core #1, D0) IPC request
activate sof_zephyr_lib_0
		sof_zephyr_lib_0 -> soc_hal: arch_start_cpu(PID: Core #1)
		activate soc_hal
			soc_hal -> core_control_1: Set alternate boot vector to FW Init
			note right: Cores share the \nsame FW binary\nand the firmware must be\npresent in SRAM.
			soc_hal -> core_control_1: Set SPA bit

			core_control_1 -> fw_init_1: Start and jump to alternate boot vector
				activate fw_init_1
				fw_init_1 -> fw_init_1: Restore context\nif any saved

			loop Until Core #1 is enabled
				soc_hal -> core_control_1: read power register
			end
			deactivate fw_init_1
		return
return

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>