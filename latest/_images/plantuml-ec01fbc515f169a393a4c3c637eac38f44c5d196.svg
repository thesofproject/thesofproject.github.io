<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="684px" preserveAspectRatio="none" style="width:893px;height:684px;" version="1.1" viewBox="0 0 893 684" width="893px" zoomAndPan="magnify"><defs><filter height="300%" id="ftctmsezcqsm7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#90EE90" height="662.0859" style="stroke: #A1A1CA; stroke-width: 1.0;" width="66" x="8" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="24" y="16.0669">Host</text><rect fill="#ADD8E6" height="662.0859" style="stroke: #A1A1CA; stroke-width: 1.0;" width="565.5" x="203" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="471.25" y="16.0669">SOF</text><rect fill="#FFFFE0" height="662.0859" style="stroke: #A1A1CA; stroke-width: 1.0;" width="104" x="778.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="781.5" y="16.0669">ACE Platform</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="564.5234" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="255" y="89.5625"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="506.2578" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="453" y="118.6953"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="674" y="205.0938"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="29.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="825.5" y="368.7578"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="29.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="825.5" y="502.4219"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="496.5" x="385" y="330.4922"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="496.5" x="385" y="464.1563"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="41" x2="41" y1="58.4297" y2="672.0859"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="260" x2="260" y1="58.4297" y2="672.0859"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="458" x2="458" y1="58.4297" y2="672.0859"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="678.5" x2="678.5" y1="58.4297" y2="672.0859"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="830.5" x2="830.5" y1="58.4297" y2="672.0859"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="54" x="12" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="19" y="43.1279">Driver</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="102" x="207" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="214" y="43.1279">IPC4 Handler</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="122" x="395" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="402" y="43.1279">Library Manager</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="167" x="593.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="600.5" y="43.1279">MPP Memory Manager</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="78" x="789.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="796.5" y="43.1279">ROM EXT</text><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="564.5234" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="255" y="89.5625"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="506.2578" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="453" y="118.6953"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="674" y="205.0938"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="29.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="825.5" y="368.7578"/><rect fill="#FFFFFF" filter="url(#ftctmsezcqsm7)" height="29.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="825.5" y="502.4219"/><polygon fill="#F05772" points="243,85.5625,253,89.5625,243,93.5625,247,89.5625" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="41" x2="249" y1="89.5625" y2="89.5625"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="48" y="84.4966">SOF_IPC4_GLB_LOAD_LIBRARY</text><polygon fill="#F05772" points="441,114.6953,451,118.6953,441,122.6953,445,118.6953" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="265" x2="447" y1="118.6953" y2="118.6953"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="272" y="113.6294">lib_manager_load_library()</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="505" y1="162.9609" y2="162.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="505" x2="505" y1="162.9609" y2="175.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="464" x2="505" y1="175.9609" y2="175.9609"/><polygon fill="#F05772" points="474,171.9609,464,175.9609,474,179.9609,470,175.9609" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="470" y="142.7622">Parse Manifest</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="470" y="157.895">Prepare Storage Memory</text><polygon fill="#F05772" points="662,201.0938,672,205.0938,662,209.0938,666,205.0938" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="668" y1="205.0938" y2="205.0938"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="470" y="200.0278">Allocate L3 memory for library</text><polygon fill="#F05772" points="474,215.0938,464,219.0938,474,223.0938,470,219.0938" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="468" x2="678" y1="219.0938" y2="219.0938"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="505" y1="248.2266" y2="248.2266"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="505" x2="505" y1="248.2266" y2="261.2266"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="464" x2="505" y1="261.2266" y2="261.2266"/><polygon fill="#F05772" points="474,257.2266,464,261.2266,474,265.2266,470,261.2266" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="470" y="243.1606">Prepare HDA DMA transfer</text><polygon fill="#F05772" points="441,306.4922,451,310.4922,441,314.4922,445,310.4922" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="41" x2="447" y1="310.4922" y2="310.4922"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="48" y="290.2935">Transfer library manifest over DMA</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="48" y="305.4263">to L3 memory</text><path d="M468,274.2266 L468,314.2266 L716,314.2266 L716,284.2266 L706,274.2266 L468,274.2266 " fill="#F6ED80" filter="url(#ftctmsezcqsm7)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M706,274.2266 L706,284.2266 L716,284.2266 L706,274.2266 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="474" y="291.2935">if SoC does not support L3 memory</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="474" y="306.4263">then L2 memory has to be used</text><path d="M385,330.4922 L455,330.4922 L455,337.4922 L445,347.4922 L385,347.4922 L385,330.4922 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="496.5" x="385" y="330.4922"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="400" y="343.5591">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="470" y="342.7026">[if AUTH_API_ENABLED]</text><polygon fill="#F05772" points="813.5,364.7578,823.5,368.7578,813.5,372.7578,817.5,368.7578" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="819.5" y1="368.7578" y2="368.7578"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="470" y="363.6919">Verify Manifest</text><polygon fill="#F05772" points="474,393.8906,464,397.8906,474,401.8906,470,397.8906" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="468" x2="829.5" y1="397.8906" y2="397.8906"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="480" y="392.8247">result</text><polygon fill="#F05772" points="441,445.1563,451,449.1563,441,453.1563,445,449.1563" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="41" x2="447" y1="449.1563" y2="449.1563"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="48" y="428.9575">Transfer library code over DMA</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="48" y="444.0903">to L3 memory</text><path d="M385,464.1563 L455,464.1563 L455,471.1563 L445,481.1563 L385,481.1563 L385,464.1563 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="496.5" x="385" y="464.1563"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="400" y="477.2231">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="470" y="476.3667">[if AUTH_API_ENABLED]</text><polygon fill="#F05772" points="813.5,498.4219,823.5,502.4219,813.5,506.4219,817.5,502.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="819.5" y1="502.4219" y2="502.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="470" y="497.356">Verify whole Library</text><polygon fill="#F05772" points="474,527.5547,464,531.5547,474,535.5547,470,531.5547" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="468" x2="829.5" y1="531.5547" y2="531.5547"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="480" y="526.4888">result</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="463" x2="505" y1="582.8203" y2="582.8203"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="505" x2="505" y1="582.8203" y2="595.8203"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="464" x2="505" y1="595.8203" y2="595.8203"/><polygon fill="#F05772" points="474,591.8203,464,595.8203,474,599.8203,470,595.8203" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="470" y="562.6216">Update Library</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="470" y="577.7544">descriptors table</text><polygon fill="#F05772" points="276,620.9531,266,624.9531,276,628.9531,272,624.9531" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="270" x2="457" y1="624.9531" y2="624.9531"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="282" y="619.8872">return status</text><polygon fill="#F05772" points="52,650.0859,42,654.0859,52,658.0859,48,654.0859" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="46" x2="259" y1="654.0859" y2="654.0859"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="58" y="649.02">Complete IPC request</text><!--MD5=[b41845975b76ac9b56a2099c16391534]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "Host" #LightGreen
	participant "Driver" as host_driver
end box

box "SOF" #LightBlue
	participant "IPC4 Handler" as ipc4_handler
	participant "Library Manager" as library_manager
	participant "MPP Memory Manager" as mpp_memory_manager
end box

box "ACE Platform" #LightYellow
	participant "ROM EXT" as rom_ext
end box


host_driver -> ipc4_handler: SOF_IPC4_GLB_LOAD_LIBRARY
	activate ipc4_handler
	ipc4_handler -> library_manager: lib_manager_load_library()
	activate library_manager
	library_manager -> library_manager: Parse Manifest \nPrepare Storage Memory
	library_manager -> mpp_memory_manager: Allocate L3 memory for library
	activate mpp_memory_manager
	mpp_memory_manager -> library_manager
	deactivate mpp_memory_manager
	library_manager -> library_manager: Prepare HDA DMA transfer
	host_driver -> library_manager: Transfer library manifest over DMA\nto L3 memory
	note right: if SoC does not support L3 memory\nthen L2 memory has to be used
	opt if AUTH_API_ENABLED
		library_manager -> rom_ext: Verify Manifest
		activate rom_ext
		rom_ext -> library_manager: result
		deactivate rom_ext
	end opt
	host_driver -> library_manager: Transfer library code over DMA\nto L3 memory
	opt if AUTH_API_ENABLED
		library_manager -> rom_ext: Verify whole Library
		activate rom_ext
		rom_ext -> library_manager: result
		deactivate rom_ext
	end opt
	library_manager -> library_manager: Update Library \ndescriptors table
	library_manager -> ipc4_handler: return status
	deactivate library_manager
ipc4_handler -> host_driver: Complete IPC request
deactivate ipc4_handler

@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.24+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>