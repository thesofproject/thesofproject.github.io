<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="485px" preserveAspectRatio="none" style="width:921px;height:485px;" version="1.1" viewBox="0 0 921 485" width="921px" zoomAndPan="magnify"><defs><filter height="300%" id="f99lfm6qh64rm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="463.5313" style="stroke: #A1A1CA; stroke-width: 1.0;" width="169" x="27.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="98.5" y="17.4951">SOF</text><rect fill="#90EE90" height="463.5313" style="stroke: #A1A1CA; stroke-width: 1.0;" width="342" x="206.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="356" y="17.4951">Zephyr</text><rect fill="#D3D3D3" height="463.5313" style="stroke: #A1A1CA; stroke-width: 1.0;" width="76" x="828.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="835.5" y="17.4951">Hardware</text><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="160.7578" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="107" y="302.7734"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="269.5" y="434.5313"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="187.1094" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="441.5" y="93.3125"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="60.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="446.5" y="204.7188"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="572" x="338.5" y="224.7188"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="327" x="21.5" y="377.4766"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="111.5" x2="111.5" y1="60.9609" y2="473.5313"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="274.5" x2="274.5" y1="60.9609" y2="473.5313"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="446.5" x2="446.5" y1="60.9609" y2="473.5313"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="866.5" x2="866.5" y1="60.9609" y2="473.5313"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="157" x="31.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="38.5" y="45.8848">MPP Memory Manager</text><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="124" x="210.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="217.5" y="45.8848">Memory Manager</text><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="192" x="348.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="178" x="355.5" y="45.8848">Memory Management Driver</text><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="64" x="832.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="839.5" y="45.8848">Memory</text><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="160.7578" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="107" y="302.7734"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="269.5" y="434.5313"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="187.1094" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="441.5" y="93.3125"/><rect fill="#FFFFFF" filter="url(#f99lfm6qh64rm)" height="60.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="446.5" y="204.7188"/><polygon fill="#F05772" points="429.5,89.3125,439.5,93.3125,429.5,97.3125,433.5,93.3125" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="3" x2="435.5" y1="93.3125" y2="93.3125"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="10" y="88.4561">sys_mm_drv_mm_init</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="451.5" x2="493.5" y1="146.6914" y2="146.6914"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="493.5" x2="493.5" y1="146.6914" y2="159.6914"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="452.5" x2="493.5" y1="159.6914" y2="159.6914"/><polygon fill="#F05772" points="462.5,155.6914,452.5,159.6914,462.5,163.6914,458.5,159.6914" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="458.5" y="125.4834">read unused_main_mem_start_marker</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="458.5" y="141.835">from linker</text><path d="M692,106.3125 L692,165.3125 L906,165.3125 L906,116.3125 L896,106.3125 L692,106.3125 " fill="#F6ED80" filter="url(#f99lfm6qh64rm)" style="stroke: #D6D6DE; stroke-width: 1.0;"/><path d="M896,106.3125 L896,116.3125 L906,116.3125 L896,106.3125 " fill="#F6ED80" style="stroke: #D6D6DE; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="698" y="124.8076">The marker is used to</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="702" y="141.1592">identify where base firmware</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="702" y="157.5107">ends in memory (text, data, bss)</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="451.5" x2="498.5" y1="191.7188" y2="191.7188"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="498.5" x2="498.5" y1="191.7188" y2="204.7188"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="457.5" x2="498.5" y1="204.7188" y2="204.7188"/><polygon fill="#F05772" points="467.5,200.7188,457.5,204.7188,467.5,208.7188,463.5,204.7188" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="396" x="463.5" y="186.8623">sys_mm_drv_unmap_region(unused_main_mem_start, unused_size)</text><path d="M338.5,224.7188 L403.5,224.7188 L403.5,232.7188 L393.5,242.7188 L338.5,242.7188 L338.5,224.7188 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="572" x="338.5" y="224.7188"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="353.5" y="239.2139">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="349" x="418.5" y="238.1377">[If architecture support granular memory banks power control]</text><polygon fill="#F05772" points="854.5,261.4219,864.5,265.4219,854.5,269.4219,858.5,265.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="451.5" x2="860.5" y1="265.4219" y2="265.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="458.5" y="260.5654">power down unused memory banks</text><polygon fill="#F05772" points="95,298.7734,105,302.7734,95,306.7734,99,302.7734" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="3" x2="101" y1="302.7734" y2="302.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="10" y="297.917">mpp_mem_init</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="117" x2="159" y1="349.4766" y2="349.4766"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="159" x2="159" y1="349.4766" y2="362.4766"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="118" x2="159" y1="362.4766" y2="362.4766"/><polygon fill="#F05772" points="128,358.4766,118,362.4766,128,366.4766,124,362.4766" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="124" y="328.2686">read memory zones</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="124" y="344.6201">base address and size</text><path d="M21.5,377.4766 L94.5,377.4766 L94.5,385.4766 L84.5,395.4766 L21.5,395.4766 L21.5,377.4766 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="327" x="21.5" y="377.4766"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="36.5" y="391.9717">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="109.5" y="390.8955">[for each memory region create heap]</text><polygon fill="#F05772" points="257.5,430.5313,267.5,434.5313,257.5,438.5313,261.5,434.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="117" x2="263.5" y1="434.5313" y2="434.5313"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="124" y="413.3232">k_heap_init</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="124" y="429.6748">(heap, mem*, size)</text><polygon fill="#F05772" points="128,444.5313,118,448.5313,128,452.5313,124,448.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122" x2="273.5" y1="448.5313" y2="448.5313"/><!--MD5=[4d4e8aa67f15785f3fc7d49b6681aa00]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "SOF" #LightBlue
	participant "MPP Memory Manager" as mpp_memory_manager
end box

box "Zephyr" #LightGreen
	participant "Memory Manager" as zephyr_memory_manager
	participant "Memory Management Driver" as memory_management_driver
end box

box "Hardware" #LightGrey
	participant "Memory" as hw_memory
end box


-> memory_management_driver: sys_mm_drv_mm_init
	activate memory_management_driver
	memory_management_driver -> memory_management_driver: read unused_main_mem_start_marker\nfrom linker
	note right: The marker is used to\n identify where base firmware\n ends in memory (text, data, bss)

	memory_management_driver -> memory_management_driver: sys_mm_drv_unmap_region(unused_main_mem_start, unused_size)
		activate memory_management_driver
		opt If architecture support granular memory banks power control
			memory_management_driver -> hw_memory: power down unused memory banks
			deactivate memory_management_driver
		end

	deactivate memory_management_driver

-> mpp_memory_manager: mpp_mem_init
	activate mpp_memory_manager
	mpp_memory_manager -> mpp_memory_manager: read memory zones\nbase address and size
	loop for each memory region create heap
		mpp_memory_manager -> zephyr_memory_manager: k_heap_init\n(heap, mem*, size)
			activate zephyr_memory_manager
			return
	end

	deactivate mpp_memory_manager

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>