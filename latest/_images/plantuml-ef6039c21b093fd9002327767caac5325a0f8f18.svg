<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="700px" preserveAspectRatio="none" style="width:1056px;height:700px;" version="1.1" viewBox="0 0 1056 700" width="1056px" zoomAndPan="magnify"><defs><filter height="300%" id="f10pbryg5j7c58" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#87CEFA" height="678.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="62" x="19" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="36.5" y="17.4951">Host</text><rect fill="#ADD8E6" height="678.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="661" x="226.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="543.5" y="17.4951">SOF</text><rect fill="#90EE90" height="678.2891" style="stroke: #A1A1CA; stroke-width: 1.0;" width="131" x="897.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="932" y="17.4951">Hardware</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="74.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="295" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="395.2188" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="295" y="275.0703"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="104.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="321.7734"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="481.5313"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="57.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="817" y="368.4766"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="107.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="817" y="532.8828"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="123.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="640.5" x="13" y="77.9609"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="433" x="220.5" y="440.8281"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="284" x="750.5" y="578.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="50" x2="50" y1="60.9609" y2="688.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="299.5" x2="299.5" y1="60.9609" y2="688.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="560.5" x2="560.5" y1="60.9609" y2="688.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="821.5" x2="821.5" y1="60.9609" y2="688.2891"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="962.5" x2="962.5" y1="60.9609" y2="688.2891"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="50" x="23" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="30" y="45.8848">driver</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="135" x="230.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="237.5" y="45.8848">Core #0: Zephyr lib</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="161" x="478.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="485.5" y="45.8848">Zephyr Power Manager</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="119" x="760.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="767.5" y="45.8848">Zephyr SoC HAL</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="119" x="901.5" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="908.5" y="45.8848">Core #1: Control</text><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="74.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="295" y="118.6641"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="395.2188" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="295" y="275.0703"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="165.3672"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="104.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="321.7734"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="556" y="481.5313"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="57.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="817" y="368.4766"/><rect fill="#FFFFFF" filter="url(#f10pbryg5j7c58)" height="107.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="817" y="532.8828"/><path d="M13,77.9609 L78,77.9609 L78,85.9609 L68,95.9609 L13,95.9609 L13,77.9609 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="123.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="640.5" x="13" y="77.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="28" y="92.4561">opt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="93" y="91.3799">[If D0ix is enabled]</text><polygon fill="#F05772" points="283,114.6641,293,118.6641,283,122.6641,287,118.6641" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="50" x2="289" y1="118.6641" y2="118.6641"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="57" y="113.8076">SET_D0ix(prevent D0ix) IPC request</text><polygon fill="#F05772" points="544,161.3672,554,165.3672,544,169.3672,548,165.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="305" x2="550" y1="165.3672" y2="165.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="312" y="144.1592">pm_policy_state_lock_get</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="312" y="160.5107">(PM_STATE_RUNTIME_IDLE)</text><polygon fill="#F05772" points="316,175.3672,306,179.3672,316,183.3672,312,179.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="310" x2="560" y1="179.3672" y2="179.3672"/><polygon fill="#F05772" points="61,189.3672,51,193.3672,61,197.3672,57,193.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="299" y1="193.3672" y2="193.3672"/><rect fill="#EEEEEE" filter="url(#f10pbryg5j7c58)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1041.5" x="3" y="229.543"/><line style="stroke: #D6D6DE; stroke-width: 0.5;" x1="3" x2="1044.5" y1="229.543" y2="229.543"/><line style="stroke: #D6D6DE; stroke-width: 0.5;" x1="3" x2="1044.5" y1="232.543" y2="232.543"/><rect fill="#EEEEEE" filter="url(#f10pbryg5j7c58)" height="24.3516" style="stroke: #D6D6DE; stroke-width: 1.0;" width="213" x="417.25" y="218.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="423.25" y="235.8623">DSP FW in PM_STATE_ACTIVE</text><polygon fill="#F05772" points="283,271.0703,293,275.0703,283,279.0703,287,275.0703" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="50" x2="289" y1="275.0703" y2="275.0703"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="57" y="270.2139">SET_DX(PID: Core #1, D3) IPC request</text><polygon fill="#F05772" points="544,317.7734,554,321.7734,544,325.7734,548,321.7734" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="305" x2="550" y1="321.7734" y2="321.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="312" y="300.5654">pm_power_state_force</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="312" y="316.917">(PM_STATE_SOFT_OFF, PID: Core #1)</text><polygon fill="#F05772" points="805,364.4766,815,368.4766,805,372.4766,809,368.4766" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="566" x2="811" y1="368.4766" y2="368.4766"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="573" y="347.2686">pm_power_state_set</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="573" y="363.6201">(PM_STATE_SOFT_OFF, PID: Core #1)</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="827" x2="869" y1="398.8281" y2="398.8281"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="869" x2="869" y1="398.8281" y2="411.8281"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="828" x2="869" y1="411.8281" y2="411.8281"/><polygon fill="#F05772" points="838,407.8281,828,411.8281,838,415.8281,834,411.8281" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="834" y="393.9717">Save context to IMR</text><polygon fill="#F05772" points="572,421.8281,562,425.8281,572,429.8281,568,425.8281" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="566" x2="821" y1="425.8281" y2="425.8281"/><path d="M220.5,440.8281 L293.5,440.8281 L293.5,448.8281 L283.5,458.8281 L220.5,458.8281 L220.5,440.8281 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="433" x="220.5" y="440.8281"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="235.5" y="455.3232">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="308.5" y="454.2471">[Until Core #1 transition to PM_STATE_SOFT_OFF]</text><polygon fill="#F05772" points="544,477.5313,554,481.5313,544,485.5313,548,481.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="305" x2="550" y1="481.5313" y2="481.5313"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="312" y="476.6748">pm_power_state_get(PID: Core #1)</text><polygon fill="#F05772" points="316,491.5313,306,495.5313,316,499.5313,312,495.5313" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="310" x2="560" y1="495.5313" y2="495.5313"/><polygon fill="#F05772" points="805,528.8828,815,532.8828,805,536.8828,809,532.8828" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="305" x2="811" y1="532.8828" y2="532.8828"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="312" y="528.0264">arch_stop_cpu(PID: Core #1)</text><polygon fill="#F05772" points="951,559.2344,961,563.2344,951,567.2344,955,563.2344" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="827" x2="957" y1="563.2344" y2="563.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="834" y="558.3779">clear power bit</text><path d="M750.5,578.2344 L823.5,578.2344 L823.5,586.2344 L813.5,596.2344 L750.5,596.2344 L750.5,578.2344 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="48.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="284" x="750.5" y="578.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="765.5" y="592.7295">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="838.5" y="591.6533">[Until Core #1 is disabled]</text><polygon fill="#F05772" points="951,614.9375,961,618.9375,951,622.9375,955,618.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="827" x2="957" y1="618.9375" y2="618.9375"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="834" y="614.0811">read power register</text><polygon fill="#F05772" points="316,635.9375,306,639.9375,316,643.9375,312,639.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="310" x2="821" y1="639.9375" y2="639.9375"/><polygon fill="#F05772" points="61,666.2891,51,670.2891,61,674.2891,57,670.2891" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="299" y1="670.2891" y2="670.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="67" y="665.4326">SET_DX(SUCCESS) IPC response</text><!--MD5=[4cd9d2be8121b944aa9eae8193bf4a6d]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

scale max 1280 width

box "Host" #LightSkyBlue
	participant "driver" as driver
end box

box "SOF" #LightBlue
	participant "Core #0: Zephyr lib" as sof_zephyr_lib_0
	participant "Zephyr Power Manager" as zephyr_power_manager
	participant "Zephyr SoC HAL" as soc_hal
end box

box "Hardware" #LightGreen
	participant "Core #1: Control" as core_1_control
end box

opt If D0ix is enabled
	driver -> sof_zephyr_lib_0: SET_D0ix(prevent D0ix) IPC request
	activate sof_zephyr_lib_0
		sof_zephyr_lib_0 -> zephyr_power_manager: pm_policy_state_lock_get\n(PM_STATE_RUNTIME_IDLE)
		activate zephyr_power_manager
		return
	return
end

== DSP FW in PM_STATE_ACTIVE ==

driver -> sof_zephyr_lib_0: SET_DX(PID: Core #1, D3) IPC request
activate sof_zephyr_lib_0
	sof_zephyr_lib_0 -> zephyr_power_manager: pm_power_state_force\n(PM_STATE_SOFT_OFF, PID: Core #1)
	activate zephyr_power_manager
		zephyr_power_manager -> soc_hal: pm_power_state_set\n(PM_STATE_SOFT_OFF, PID: Core #1)
		activate soc_hal
			soc_hal -> soc_hal: Save context to IMR
		return
	deactivate zephyr_power_manager

	loop Until Core #1 transition to PM_STATE_SOFT_OFF
		sof_zephyr_lib_0 -> zephyr_power_manager: pm_power_state_get(PID: Core #1)
		activate zephyr_power_manager
		return
	end

	sof_zephyr_lib_0 -> soc_hal: arch_stop_cpu(PID: Core #1)
	activate soc_hal
		soc_hal -> core_1_control: clear power bit
		loop Until Core #1 is disabled
			soc_hal -> core_1_control: read power register
		end
	return

return SET_DX(SUCCESS) IPC response

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>