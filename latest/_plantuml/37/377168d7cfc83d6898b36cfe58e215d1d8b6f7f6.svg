<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1159px" preserveAspectRatio="none" style="width:933px;height:1159px;" version="1.1" viewBox="0 0 933 1159" width="933px" zoomAndPan="magnify"><defs><filter height="300%" id="fte9lg3eysfj4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="1137.6875" style="stroke: #A1A1CA; stroke-width: 1.0;" width="723.5" x="39" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="336.25" y="16.0669">DSP #0 (primary)</text><rect fill="#DDDDDD" height="1137.6875" style="stroke: #A1A1CA; stroke-width: 1.0;" width="124" x="772.5" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="785" y="16.0669">Shared SRAM</text><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="117.3984" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="180.9609"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="334.4922"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="43.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="494.8906"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="262.7344" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="626.2891"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="43.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="977.2891"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="1108.6875"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="67.2656" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="829.5" y="210.0938"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="253.0625" style="stroke: #A1A1CA; stroke-width: 2.0;" width="909.5" x="13" y="103.4297"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="178.7969" style="stroke: #A1A1CA; stroke-width: 2.0;" width="889.5" x="23" y="127.5625"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="60.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="225.0938"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="147.5313" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="398.4922"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="44.1328" style="stroke: #A1A1CA; stroke-width: 2.0;" width="211" x="557.5" y="422.625"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="309" style="stroke: #A1A1CA; stroke-width: 2.0;" width="909.5" x="13" y="588.0234"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="205.6016" style="stroke: #A1A1CA; stroke-width: 2.0;" width="889.5" x="23" y="670.4219"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="145.3359" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="723.6875"/><rect fill="#FFFFFF" height="86.0703" style="stroke: none; stroke-width: 1.0;" width="869.5" x="33" y="782.9531"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="89.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="939.0234"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="60.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="534.5" x="33" y="1070.4219"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="58.4297" y2="68.4297"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="98" x2="98" y1="68.4297" y2="96.4297"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="96.4297" y2="363.4922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="98" x2="98" y1="363.4922" y2="391.4922"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="391.4922" y2="553.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="98" x2="98" y1="553.0234" y2="581.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="581.0234" y2="904.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="98" x2="98" y1="904.0234" y2="932.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="932.0234" y2="1035.4219"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="98" x2="98" y1="1035.4219" y2="1063.4219"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="98" x2="98" y1="1063.4219" y2="1147.6875"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="58.4297" y2="68.4297"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="507.5" x2="507.5" y1="68.4297" y2="96.4297"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="96.4297" y2="363.4922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="507.5" x2="507.5" y1="363.4922" y2="391.4922"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="391.4922" y2="553.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="507.5" x2="507.5" y1="553.0234" y2="581.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="581.0234" y2="904.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="507.5" x2="507.5" y1="904.0234" y2="932.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="932.0234" y2="1035.4219"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="507.5" x2="507.5" y1="1035.4219" y2="1063.4219"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="507.5" x2="507.5" y1="1063.4219" y2="1147.6875"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="58.4297" y2="68.4297"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="68.4297" y2="96.4297"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="96.4297" y2="363.4922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="363.4922" y2="391.4922"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="391.4922" y2="553.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="553.0234" y2="581.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="581.0234" y2="904.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="904.0234" y2="932.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="932.0234" y2="1035.4219"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="1035.4219" y2="1063.4219"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="1063.4219" y2="1147.6875"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="58.4297" y2="68.4297"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="834.5" x2="834.5" y1="68.4297" y2="96.4297"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="96.4297" y2="363.4922"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="834.5" x2="834.5" y1="363.4922" y2="391.4922"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="391.4922" y2="553.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="834.5" x2="834.5" y1="553.0234" y2="581.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="581.0234" y2="904.0234"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="834.5" x2="834.5" y1="904.0234" y2="932.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="932.0234" y2="1035.4219"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="834.5" x2="834.5" y1="1035.4219" y2="1063.4219"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="834.5" x2="834.5" y1="1063.4219" y2="1147.6875"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="107" x="43" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="50" y="43.1279">DSP #0: AMS</text><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="96" x="457.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="464.5" y="43.1279">DSP #0: KR</text><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="187" x="567.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="574.5" y="43.1279">DSP #0: Custom module</text><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="30.2969" style="stroke: #33335B; stroke-width: 1.5;" width="112" x="776.5" y="23.1328"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="783.5" y="43.1279">AMS database</text><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="117.3984" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="180.9609"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="334.4922"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="43.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="494.8906"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="262.7344" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="626.2891"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="43.1328" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="977.2891"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="93.5" y="1108.6875"/><rect fill="#FFFFFF" filter="url(#fte9lg3eysfj4)" height="67.2656" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="829.5" y="210.0938"/><path d="M13,103.4297 L374,103.4297 L374,110.4297 L364,120.4297 L13,120.4297 L13,103.4297 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="253.0625" style="stroke: #A1A1CA; stroke-width: 2.0;" width="909.5" x="13" y="103.4297"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="316" x="28" y="116.4966">Register KEY_PHRASE_DETECTED producer</text><path d="M23,127.5625 L185,127.5625 L185,134.5625 L175,144.5625 L23,144.5625 L23,127.5625 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="178.7969" style="stroke: #A1A1CA; stroke-width: 2.0;" width="889.5" x="23" y="127.5625"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="38" y="140.6294">Get Message ID</text><polygon fill="#F05772" points="114.5,176.9609,104.5,180.9609,114.5,184.9609,110.5,180.9609" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="506.5" y1="180.9609" y2="180.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="120.5" y="160.7622">am_service_get_message_type_id(KEY_PHRASE_DETECTED</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="120.5" y="175.895">UUID)</text><polygon fill="#F05772" points="817.5,206.0938,827.5,210.0938,817.5,214.0938,821.5,210.0938" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="823.5" y1="210.0938" y2="210.0938"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="110.5" y="205.0278">Find ID for KEY_PHRASE_DETECTED message</text><path d="M33,225.0938 L97,225.0938 L97,232.0938 L87,242.0938 L33,242.0938 L33,225.0938 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="60.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="225.0938"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="48" y="238.1606">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="252" x="112" y="237.3042">[If no KEY_PHRASE_DETECTED is found]</text><polygon fill="#F05772" points="817.5,259.3594,827.5,263.3594,817.5,267.3594,821.5,263.3594" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="823.5" y1="263.3594" y2="263.3594"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="110.5" y="258.2935">Assign ID to KEY_PHRASE_DETECTED message</text><polygon fill="#F05772" points="114.5,273.3594,104.5,277.3594,114.5,281.3594,110.5,277.3594" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="108.5" x2="833.5" y1="277.3594" y2="277.3594"/><polygon fill="#F05772" points="495.5,294.3594,505.5,298.3594,495.5,302.3594,499.5,298.3594" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="501.5" y1="298.3594" y2="298.3594"/><polygon fill="#F05772" points="114.5,330.4922,104.5,334.4922,114.5,338.4922,110.5,334.4922" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="506.5" y1="334.4922" y2="334.4922"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="120.5" y="329.4263">am_service_register_producer(message_id)</text><polygon fill="#F05772" points="495.5,344.4922,505.5,348.4922,495.5,352.4922,499.5,348.4922" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="501.5" y1="348.4922" y2="348.4922"/><path d="M33,398.4922 L399,398.4922 L399,405.4922 L389,415.4922 L33,415.4922 L33,398.4922 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="147.5313" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="398.4922"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="321" x="48" y="411.5591">Register KEY_PHRASE_DETECTED consumer</text><path d="M557.5,422.625 L719.5,422.625 L719.5,429.625 L709.5,439.625 L557.5,439.625 L557.5,422.625 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="44.1328" style="stroke: #A1A1CA; stroke-width: 2.0;" width="211" x="557.5" y="422.625"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="572.5" y="435.6919">Get Message ID</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="663" x2="705" y1="445.7578" y2="445.7578"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="705" x2="705" y1="445.7578" y2="458.7578"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="664" x2="705" y1="458.7578" y2="458.7578"/><polygon fill="#F05772" points="674,454.7578,664,458.7578,674,462.7578,670,458.7578" style="stroke: #F05772; stroke-width: 1.0;"/><polygon fill="#F05772" points="114.5,490.8906,104.5,494.8906,114.5,498.8906,110.5,494.8906" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="662" y1="494.8906" y2="494.8906"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="120.5" y="489.8247">am_service_register_consumer(message_id, callback)</text><polygon fill="#F05772" points="822.5,520.0234,832.5,524.0234,822.5,528.0234,826.5,524.0234" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="828.5" y1="524.0234" y2="524.0234"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="110.5" y="518.9575">Add KEY_PHRASE_DETECTED message consumer</text><polygon fill="#F05772" points="651,534.0234,661,538.0234,651,542.0234,655,538.0234" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="657" y1="538.0234" y2="538.0234"/><path d="M13,588.0234 L214,588.0234 L214,595.0234 L204,605.0234 L13,605.0234 L13,588.0234 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="309" style="stroke: #A1A1CA; stroke-width: 2.0;" width="909.5" x="13" y="588.0234"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="28" y="601.0903">Send Async Message</text><polygon fill="#F05772" points="114.5,622.2891,104.5,626.2891,114.5,630.2891,110.5,626.2891" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="506.5" y1="626.2891" y2="626.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="120.5" y="621.2231">am_service_send_message(lp_kpd_id, message)</text><polygon fill="#F05772" points="822.5,651.4219,832.5,655.4219,822.5,659.4219,826.5,655.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="828.5" y1="655.4219" y2="655.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="110.5" y="650.356">Get KEY_PHRASE_DETECTED consumers</text><path d="M23,670.4219 L100,670.4219 L100,677.4219 L90,687.4219 L23,687.4219 L23,670.4219 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="205.6016" style="stroke: #A1A1CA; stroke-width: 2.0;" width="889.5" x="23" y="670.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="38" y="683.4888">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="115" y="682.6323">[Until all consumer are called]</text><polygon fill="#F05772" points="822.5,704.6875,832.5,708.6875,822.5,712.6875,826.5,708.6875" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="828.5" y1="708.6875" y2="708.6875"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="110.5" y="703.6216">Get AMS consumer Processor ID</text><path d="M33,723.6875 L97,723.6875 L97,730.6875 L87,740.6875 L33,740.6875 L33,723.6875 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="145.3359" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="723.6875"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="48" y="736.7544">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="343" x="112" y="735.8979">[AMS Consumer Processor ID != Current Processor ID]</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="145.5" y1="761.9531" y2="761.9531"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="145.5" x2="145.5" y1="761.9531" y2="774.9531"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="145.5" y1="774.9531" y2="774.9531"/><polygon fill="#F05772" points="114.5,770.9531,104.5,774.9531,114.5,778.9531,110.5,774.9531" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="110.5" y="756.8872">Forward AMS message to the consumer's core</text><line style="stroke: #A1A1CA; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="902.5" y1="783.9531" y2="783.9531"/><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="347" x="38" y="794.1636">[AMS Consumer Processor ID == Current Processor ID]</text><polygon fill="#F05772" points="822.5,814.8906,832.5,818.8906,822.5,822.8906,826.5,818.8906" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="828.5" y1="818.8906" y2="818.8906"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="110.5" y="813.8247">Get AMS consumer callback</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="145.5" y1="848.0234" y2="848.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="145.5" x2="145.5" y1="848.0234" y2="861.0234"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="145.5" y1="861.0234" y2="861.0234"/><polygon fill="#F05772" points="114.5,857.0234,104.5,861.0234,114.5,865.0234,110.5,861.0234" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="110.5" y="842.9575">Call consumer AMS callback</text><polygon fill="#F05772" points="495.5,885.0234,505.5,889.0234,495.5,893.0234,499.5,889.0234" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="501.5" y1="889.0234" y2="889.0234"/><path d="M33,939.0234 L414,939.0234 L414,946.0234 L404,956.0234 L33,956.0234 L33,939.0234 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="89.3984" style="stroke: #A1A1CA; stroke-width: 2.0;" width="869.5" x="33" y="939.0234"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="336" x="48" y="952.0903">Unregister KEY_PHRASE_DETECTED consumer</text><polygon fill="#F05772" points="114.5,973.2891,104.5,977.2891,114.5,981.2891,110.5,977.2891" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="662" y1="977.2891" y2="977.2891"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="120.5" y="972.2231">am_service_unregister_consumer(message_id, callback)</text><polygon fill="#F05772" points="822.5,1002.4219,832.5,1006.4219,822.5,1010.4219,826.5,1006.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="103.5" x2="828.5" y1="1006.4219" y2="1006.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="110.5" y="1001.356">Remove KEY_PHRASE_DETECTED message consumer</text><polygon fill="#F05772" points="651,1016.4219,661,1020.4219,651,1024.4219,655,1020.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="657" y1="1020.4219" y2="1020.4219"/><path d="M33,1070.4219 L409,1070.4219 L409,1077.4219 L399,1087.4219 L33,1087.4219 L33,1070.4219 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="60.2656" style="stroke: #A1A1CA; stroke-width: 2.0;" width="534.5" x="33" y="1070.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="331" x="48" y="1083.4888">Unregister KEY_PHRASE_DETECTED producer</text><polygon fill="#F05772" points="114.5,1104.6875,104.5,1108.6875,114.5,1112.6875,110.5,1108.6875" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="108.5" x2="506.5" y1="1108.6875" y2="1108.6875"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="120.5" y="1103.6216">am_service_unregister_producer(message_id)</text><polygon fill="#F05772" points="495.5,1118.6875,505.5,1122.6875,495.5,1126.6875,499.5,1122.6875" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="501.5" y1="1122.6875" y2="1122.6875"/><!--MD5=[9a0a8988d88d4e015202e2f01e2f25b0]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "DSP #0 (primary)" #LightBlue
	participant "DSP #0: AMS" as ams
	participant "DSP #0: KR" as kr
	participant "DSP #0: Custom module" as custom_module
end box

box "Shared SRAM"
	participant "AMS database" as ams_db
end box

...

group Register KEY_PHRASE_DETECTED producer
	group Get Message ID
		kr -> ams: am_service_get_message_type_id(KEY_PHRASE_DETECTED UUID)
		activate ams
		ams -> ams_db: Find ID for KEY_PHRASE_DETECTED message
		activate ams_db
		alt If no KEY_PHRASE_DETECTED is found
			ams -> ams_db: Assign ID to KEY_PHRASE_DETECTED message
			return
		end
		return
	end

	kr -> ams: am_service_register_producer(message_id)
		activate ams
		return
end

...

group Register KEY_PHRASE_DETECTED consumer
	group Get Message ID
		custom_module-> custom_module
	end

	custom_module -> ams: am_service_register_consumer(message_id, callback)
		activate ams
		ams -> ams_db: Add KEY_PHRASE_DETECTED message consumer
		return
end

...

group Send Async Message
	kr -> ams: am_service_send_message(lp_kpd_id, message)
	activate ams

	ams -> ams_db: Get KEY_PHRASE_DETECTED consumers
	loop Until all consumer are called
		ams -> ams_db: Get AMS consumer Processor ID

		alt AMS Consumer Processor ID != Current Processor ID
			ams -> ams: Forward AMS message to the consumer's core
		else AMS Consumer Processor ID == Current Processor ID
			ams -> ams_db: Get AMS consumer callback
			ams -> ams: Call consumer AMS callback
		end
	end
	return
end

...

group Unregister KEY_PHRASE_DETECTED consumer
	custom_module -> ams: am_service_unregister_consumer(message_id, callback)
		activate ams
		ams -> ams_db: Remove KEY_PHRASE_DETECTED message consumer
		return
end

...

group Unregister KEY_PHRASE_DETECTED producer
	kr -> ams: am_service_unregister_producer(message_id)
		activate ams
		return
end

@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.26+4
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>