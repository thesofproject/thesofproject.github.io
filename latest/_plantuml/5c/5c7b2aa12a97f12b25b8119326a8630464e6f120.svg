<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1194px" preserveAspectRatio="none" style="width:916px;height:1194px;" version="1.1" viewBox="0 0 916 1194" width="916px" zoomAndPan="magnify"><defs><filter height="300%" id="fbrngzljjhhhm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="1172.9375" style="stroke: #A1A1CA; stroke-width: 1.0;" width="712" x="39" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="342" y="17.4951">DSP #0 (primary)</text><rect fill="#DDDDDD" height="1172.9375" style="stroke: #A1A1CA; stroke-width: 1.0;" width="118" x="761" y="4"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="776" y="17.4951">Shared SRAM</text><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="121.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="188.3672"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="346.7734"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="44.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="510.8281"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="272.2969" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="645.8828"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="44.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="1008.8828"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="1143.9375"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="69.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="815" y="218.7188"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="262.8125" style="stroke: #A1A1CA; stroke-width: 2.0;" width="892" x="13" y="105.9609"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="186.1094" style="stroke: #A1A1CA; stroke-width: 2.0;" width="872" x="23" y="131.3125"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="233.7188"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="152.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="410.7734"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="45.3516" style="stroke: #A1A1CA; stroke-width: 2.0;" width="192" x="565" y="436.125"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="321" style="stroke: #A1A1CA; stroke-width: 2.0;" width="892" x="13" y="605.1797"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="213.9453" style="stroke: #A1A1CA; stroke-width: 2.0;" width="872" x="23" y="691.2344"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="151.2422" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="746.9375"/><rect fill="#FFFFFF" height="89.5391" style="stroke: none; stroke-width: 1.0;" width="852" x="33" y="808.6406"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="93.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="968.1797"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="542" x="33" y="1103.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="60.9609" y2="70.9609"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="94" x2="94" y1="70.9609" y2="98.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="98.9609" y2="375.7734"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="94" x2="94" y1="375.7734" y2="403.7734"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="403.7734" y2="570.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="94" x2="94" y1="570.1797" y2="598.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="598.1797" y2="933.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="94" x2="94" y1="933.1797" y2="961.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="961.1797" y2="1068.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="94" x2="94" y1="1068.2344" y2="1096.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="94" x2="94" y1="1096.2344" y2="1182.9375"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="60.9609" y2="70.9609"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="518" x2="518" y1="70.9609" y2="98.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="98.9609" y2="375.7734"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="518" x2="518" y1="375.7734" y2="403.7734"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="403.7734" y2="570.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="518" x2="518" y1="570.1797" y2="598.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="598.1797" y2="933.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="518" x2="518" y1="933.1797" y2="961.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="961.1797" y2="1068.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="518" x2="518" y1="1068.2344" y2="1096.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="518" x2="518" y1="1096.2344" y2="1182.9375"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="60.9609" y2="70.9609"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="661" x2="661" y1="70.9609" y2="98.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="98.9609" y2="375.7734"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="661" x2="661" y1="375.7734" y2="403.7734"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="403.7734" y2="570.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="661" x2="661" y1="570.1797" y2="598.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="598.1797" y2="933.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="661" x2="661" y1="933.1797" y2="961.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="961.1797" y2="1068.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="661" x2="661" y1="1068.2344" y2="1096.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="661" y1="1096.2344" y2="1182.9375"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="60.9609" y2="70.9609"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="820" x2="820" y1="70.9609" y2="98.9609"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="98.9609" y2="375.7734"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="820" x2="820" y1="375.7734" y2="403.7734"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="403.7734" y2="570.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="820" x2="820" y1="570.1797" y2="598.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="598.1797" y2="933.1797"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="820" x2="820" y1="933.1797" y2="961.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="961.1797" y2="1068.2344"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="820" x2="820" y1="1068.2344" y2="1096.2344"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="820" x2="820" y1="1096.2344" y2="1182.9375"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="99" x="43" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="50" y="45.8848">DSP #0: AMS</text><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="89" x="472" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="479" y="45.8848">DSP #0: KR</text><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="168" x="575" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="582" y="45.8848">DSP #0: Custom module</text><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="31.6094" style="stroke: #33335B; stroke-width: 1.5;" width="106" x="765" y="24.3516"/><text fill="#33335B" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="772" y="45.8848">AMS database</text><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="121.0547" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="188.3672"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="346.7734"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="44.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="510.8281"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="272.2969" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="645.8828"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="44.3516" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="1008.8828"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="14" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="89.5" y="1143.9375"/><rect fill="#FFFFFF" filter="url(#fbrngzljjhhhm)" height="69.7031" style="stroke: #F05772; stroke-width: 1.0;" width="10" x="815" y="218.7188"/><path d="M13,105.9609 L334,105.9609 L334,113.9609 L324,123.9609 L13,123.9609 L13,105.9609 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="262.8125" style="stroke: #A1A1CA; stroke-width: 2.0;" width="892" x="13" y="105.9609"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="28" y="120.4561">Register KEY_PHRASE_DETECTED producer</text><path d="M23,131.3125 L166,131.3125 L166,139.3125 L156,149.3125 L23,149.3125 L23,131.3125 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="186.1094" style="stroke: #A1A1CA; stroke-width: 2.0;" width="872" x="23" y="131.3125"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="38" y="145.8076">Get Message ID</text><polygon fill="#F05772" points="110.5,184.3672,100.5,188.3672,110.5,192.3672,106.5,188.3672" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="517.5" y1="188.3672" y2="188.3672"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="116.5" y="167.1592">am_service_get_message_type_id(KEY_PHRASE_DETECTED UUID</text><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="116.5" y="183.5107">)</text><polygon fill="#F05772" points="803,214.7188,813,218.7188,803,222.7188,807,218.7188" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="809" y1="218.7188" y2="218.7188"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="106.5" y="213.8623">Find ID for KEY_PHRASE_DETECTED message</text><path d="M33,233.7188 L94,233.7188 L94,241.7188 L84,251.7188 L33,251.7188 L33,233.7188 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="233.7188"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="48" y="248.2139">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="109" y="247.1377">[If no KEY_PHRASE_DETECTED is found]</text><polygon fill="#F05772" points="803,270.4219,813,274.4219,803,278.4219,807,274.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="809" y1="274.4219" y2="274.4219"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="106.5" y="269.5654">Assign ID to KEY_PHRASE_DETECTED message</text><polygon fill="#F05772" points="110.5,284.4219,100.5,288.4219,110.5,292.4219,106.5,288.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="104.5" x2="819" y1="288.4219" y2="288.4219"/><polygon fill="#F05772" points="506.5,305.4219,516.5,309.4219,506.5,313.4219,510.5,309.4219" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="512.5" y1="309.4219" y2="309.4219"/><polygon fill="#F05772" points="110.5,342.7734,100.5,346.7734,110.5,350.7734,106.5,346.7734" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="517.5" y1="346.7734" y2="346.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="116.5" y="341.917">am_service_register_producer(message_id)</text><polygon fill="#F05772" points="506.5,356.7734,516.5,360.7734,506.5,364.7734,510.5,360.7734" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="512.5" y1="360.7734" y2="360.7734"/><path d="M33,410.7734 L359,410.7734 L359,418.7734 L349,428.7734 L33,428.7734 L33,410.7734 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="152.4063" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="410.7734"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="281" x="48" y="425.2686">Register KEY_PHRASE_DETECTED consumer</text><path d="M565,436.125 L708,436.125 L708,444.125 L698,454.125 L565,454.125 L565,436.125 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="45.3516" style="stroke: #A1A1CA; stroke-width: 2.0;" width="192" x="565" y="436.125"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="580" y="450.6201">Get Message ID</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="661" x2="703" y1="460.4766" y2="460.4766"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="703" x2="703" y1="460.4766" y2="473.4766"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="662" x2="703" y1="473.4766" y2="473.4766"/><polygon fill="#F05772" points="672,469.4766,662,473.4766,672,477.4766,668,473.4766" style="stroke: #F05772; stroke-width: 1.0;"/><polygon fill="#F05772" points="110.5,506.8281,100.5,510.8281,110.5,514.8281,106.5,510.8281" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="660" y1="510.8281" y2="510.8281"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="116.5" y="505.9717">am_service_register_consumer(message_id, callback)</text><polygon fill="#F05772" points="808,537.1797,818,541.1797,808,545.1797,812,541.1797" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="814" y1="541.1797" y2="541.1797"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="106.5" y="536.3232">Add KEY_PHRASE_DETECTED message consumer</text><polygon fill="#F05772" points="649,551.1797,659,555.1797,649,559.1797,653,555.1797" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="655" y1="555.1797" y2="555.1797"/><path d="M13,605.1797 L191,605.1797 L191,613.1797 L181,623.1797 L13,623.1797 L13,605.1797 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="321" style="stroke: #A1A1CA; stroke-width: 2.0;" width="892" x="13" y="605.1797"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="28" y="619.6748">Send Async Message</text><polygon fill="#F05772" points="110.5,641.8828,100.5,645.8828,110.5,649.8828,106.5,645.8828" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="517.5" y1="645.8828" y2="645.8828"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="116.5" y="641.0264">am_service_send_message(lp_kpd_id, message)</text><polygon fill="#F05772" points="808,672.2344,818,676.2344,808,680.2344,812,676.2344" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="814" y1="676.2344" y2="676.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="106.5" y="671.3779">Get KEY_PHRASE_DETECTED consumers</text><path d="M23,691.2344 L96,691.2344 L96,699.2344 L86,709.2344 L23,709.2344 L23,691.2344 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="213.9453" style="stroke: #A1A1CA; stroke-width: 2.0;" width="872" x="23" y="691.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="38" y="705.7295">loop</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="111" y="704.6533">[Until all consumer are called]</text><polygon fill="#F05772" points="808,727.9375,818,731.9375,808,735.9375,812,731.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="814" y1="731.9375" y2="731.9375"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="106.5" y="727.0811">Get AMS consumer Processor ID</text><path d="M33,746.9375 L94,746.9375 L94,754.9375 L84,764.9375 L33,764.9375 L33,746.9375 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="151.2422" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="746.9375"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="48" y="761.4326">alt</text><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="301" x="109" y="760.3564">[AMS Consumer Processor ID != Current Processor ID]</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="141.5" y1="787.6406" y2="787.6406"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="141.5" x2="141.5" y1="787.6406" y2="800.6406"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="100.5" x2="141.5" y1="800.6406" y2="800.6406"/><polygon fill="#F05772" points="110.5,796.6406,100.5,800.6406,110.5,804.6406,106.5,800.6406" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="106.5" y="782.7842">Forward AMS message to the consumer's core</text><line style="stroke: #A1A1CA; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="885" y1="809.6406" y2="809.6406"/><text fill="#33335B" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="304" x="38" y="821.0596">[AMS Consumer Processor ID == Current Processor ID]</text><polygon fill="#F05772" points="808,842.8281,818,846.8281,808,850.8281,812,846.8281" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="814" y1="846.8281" y2="846.8281"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="106.5" y="841.9717">Get AMS consumer callback</text><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="141.5" y1="877.1797" y2="877.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="141.5" x2="141.5" y1="877.1797" y2="890.1797"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="100.5" x2="141.5" y1="890.1797" y2="890.1797"/><polygon fill="#F05772" points="110.5,886.1797,100.5,890.1797,110.5,894.1797,106.5,890.1797" style="stroke: #F05772; stroke-width: 1.0;"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="106.5" y="872.3232">Call consumer AMS callback</text><polygon fill="#F05772" points="506.5,914.1797,516.5,918.1797,506.5,922.1797,510.5,918.1797" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="512.5" y1="918.1797" y2="918.1797"/><path d="M33,968.1797 L372,968.1797 L372,976.1797 L362,986.1797 L33,986.1797 L33,968.1797 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="93.0547" style="stroke: #A1A1CA; stroke-width: 2.0;" width="852" x="33" y="968.1797"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="294" x="48" y="982.6748">Unregister KEY_PHRASE_DETECTED consumer</text><polygon fill="#F05772" points="110.5,1004.8828,100.5,1008.8828,110.5,1012.8828,106.5,1008.8828" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="660" y1="1008.8828" y2="1008.8828"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="116.5" y="1004.0264">am_service_unregister_consumer(message_id, callback)</text><polygon fill="#F05772" points="808,1035.2344,818,1039.2344,808,1043.2344,812,1039.2344" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="99.5" x2="814" y1="1039.2344" y2="1039.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="106.5" y="1034.3779">Remove KEY_PHRASE_DETECTED message consumer</text><polygon fill="#F05772" points="649,1049.2344,659,1053.2344,649,1057.2344,653,1053.2344" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="655" y1="1053.2344" y2="1053.2344"/><path d="M33,1103.2344 L367,1103.2344 L367,1111.2344 L357,1121.2344 L33,1121.2344 L33,1103.2344 " fill="#EEEEEE" style="stroke: #A1A1CA; stroke-width: 1.0;"/><rect fill="none" height="62.7031" style="stroke: #A1A1CA; stroke-width: 2.0;" width="542" x="33" y="1103.2344"/><text fill="#33335B" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="289" x="48" y="1117.7295">Unregister KEY_PHRASE_DETECTED producer</text><polygon fill="#F05772" points="110.5,1139.9375,100.5,1143.9375,110.5,1147.9375,106.5,1143.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0;" x1="104.5" x2="517.5" y1="1143.9375" y2="1143.9375"/><text fill="#33335B" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="116.5" y="1139.0811">am_service_unregister_producer(message_id)</text><polygon fill="#F05772" points="506.5,1153.9375,516.5,1157.9375,506.5,1161.9375,510.5,1157.9375" style="stroke: #F05772; stroke-width: 1.0;"/><line style="stroke: #F05772; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="94.5" x2="512.5" y1="1157.9375" y2="1157.9375"/><!--MD5=[daa71de15ad09e22509c18395f1aa796]
@startuml
hidefootbox
skinparam componentStyle uml2

skinparam defaultFontColor	#33335b

skinparam rectangle {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam queue {
	color		#d6d6de
	backgroundColor	#ffffff
}

skinparam component {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}

skinparam interface {
	backgroundColor	#ffffff
	borderColor	#f05772
}

skinparam class {
	backgroundColor	#ffffff
	borderColor	#33335b
	arrowColor	#f05772
}
skinparam stereotypeCBackgroundColor	#6fccdd

skinparam sequence {
	arrowColor		#4a4a86
	lifeLineBorderColor	#f05772
	groupBorderColor	#a1a1ca
	boxBorderColor		#a1a1ca
	dividerBorderColor	#d6d6de
	dividerBorderThickness	1
}
skinparam participant {
	borderColor		#33335b
	backgroundColor		#ffffff
}
skinparam actor {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam state {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam node {
	backgroundColor		#ffffff
}

skinparam note {
	backgroundColor 	#f6ed80
	borderColor		#d6d6de
}

skinparam activity {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam activityDiamond {
	borderColor		#33335b
	backgroundColor		#ffffff
}

skinparam arrowColor	#f05772
skinparam maxMessageSize 400
skinparam BoxPadding 4

box "DSP #0 (primary)" #LightBlue
	participant "DSP #0: AMS" as ams
	participant "DSP #0: KR" as kr
	participant "DSP #0: Custom module" as custom_module
end box

box "Shared SRAM"
	participant "AMS database" as ams_db
end box

...

group Register KEY_PHRASE_DETECTED producer
	group Get Message ID
		kr -> ams: am_service_get_message_type_id(KEY_PHRASE_DETECTED UUID)
		activate ams
		ams -> ams_db: Find ID for KEY_PHRASE_DETECTED message
		activate ams_db
		alt If no KEY_PHRASE_DETECTED is found
			ams -> ams_db: Assign ID to KEY_PHRASE_DETECTED message
			return
		end
		return
	end

	kr -> ams: am_service_register_producer(message_id)
		activate ams
		return
end

...

group Register KEY_PHRASE_DETECTED consumer
	group Get Message ID
		custom_module-> custom_module
	end

	custom_module -> ams: am_service_register_consumer(message_id, callback)
		activate ams
		ams -> ams_db: Add KEY_PHRASE_DETECTED message consumer
		return
end

...

group Send Async Message
	kr -> ams: am_service_send_message(lp_kpd_id, message)
	activate ams

	ams -> ams_db: Get KEY_PHRASE_DETECTED consumers
	loop Until all consumer are called
		ams -> ams_db: Get AMS consumer Processor ID

		alt AMS Consumer Processor ID != Current Processor ID
			ams -> ams: Forward AMS message to the consumer's core
		else AMS Consumer Processor ID == Current Processor ID
			ams -> ams_db: Get AMS consumer callback
			ams -> ams: Call consumer AMS callback
		end
	end
	return
end

...

group Unregister KEY_PHRASE_DETECTED consumer
	custom_module -> ams: am_service_unregister_consumer(message_id, callback)
		activate ams
		ams -> ams_db: Remove KEY_PHRASE_DETECTED message consumer
		return
end

...

group Unregister KEY_PHRASE_DETECTED producer
	kr -> ams: am_service_unregister_producer(message_id)
		activate ams
		return
end

@enduml

PlantUML version 1.2019.12(Sun Nov 03 11:24:54 CET 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_302-b08
Operating System: Windows 10
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>