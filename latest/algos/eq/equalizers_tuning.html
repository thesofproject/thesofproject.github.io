<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Equalizers, IIR and FIR &mdash; SOF Project 2.5.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sof-custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/sof-favicon-16x16.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sample Rate Conversion" href="../src/sample_rate_conversion.html" />
    <link rel="prev" title="Multiplexer/Demultiplexer" href="../demux/demux.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            SOF Project
              <img src="../../_static/logo_sof_white_200w.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://sofproject.org">SOF project website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to the SOF Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#sdk-introduction-and-overview">SDK Introduction and Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#sof-source-code-tools-and-topologies">SOF source code, tools, and topologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#host-os-drivers">Host OS Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#firmware-toolchain">Firmware Toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../introduction/index.html#dsp-emulator">DSP Emulator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#general-faq">General FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#toolchain-faq">Toolchain FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#build-sof">Build SOF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html">Build toolchains and SOF from sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-1-set-up-the-workspace-directory">Step 1. Set up the workspace directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-2-set-up-build-environment">Step 2. Set up build environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-3-build-toolchains-from-source">Step 3. Build toolchains from source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-4-build-and-sign-firmware-binaries">Step 4. Build and sign firmware binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-5-build-topology-and-tools">Step 5. Build topology and tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-from-scratch.html#step-6-build-linux-kernel">Step 6. Build Linux kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/build-guide/build-with-docker.html">Build SOF with Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-docker.html#set-up-the-workspace-directory">Set up the workspace directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-docker.html#set-up-docker">Set up Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-docker.html#build-firmware-binaries-with-docker">Build firmware binaries with Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-docker.html#build-topology-and-tools-with-docker">Build topology and tools with Docker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/build-guide/build-3rd-party-toolchain.html">Build SOF with a 3rd Party Toolchain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-3rd-party-toolchain.html#cadence-tensilica-xtensa-c-c-compiler-xcc">Cadence® Tensilica® Xtensa® C/C++ Compiler (XCC)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html">Build SOF with Zephyr</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#prepare">Prepare</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#clone-and-initialize-sof-project">Clone and initialize SOF project</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#check-out-and-build-using-python-convenience-script">Check out and build using Python convenience script</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#check-out-and-build-using-west-tool-directly">Check out and build using west tool directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#run">Run</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/build-guide/build-with-zephyr.html#troubleshoot">Troubleshoot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#set-up-sof-on-a-linux-machine">Set up SOF on a Linux machine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/setup_linux/prepare_build_environment.html">Set up a Development Environment to Build the Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/setup_linux/install_locally.html">Install the Kernel Locally</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/install_locally.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/install_locally.html#build-and-install-the-kernel">Build and install the kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/install_locally.html#update-and-rebuild">Update and rebuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/install_locally.html#remove-the-kernel">Remove the kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/setup_linux/setup_ktest_environment.html">Set up a Ktest-based Environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/setup_ktest_environment.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/setup_ktest_environment.html#set-up-a-target">Set up a target</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/setup_ktest_environment.html#configure-ssh-without-password">Configure SSH without password</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_linux/setup_ktest_environment.html#build-and-install-the-kernel-with-ktest">Build and install the kernel with ktest</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#set-up-sof-on-a-special-device">Set up SOF on a special device</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/setup_special_device/setup_minnowboard_turbot.html">Set up SOF on MinnowBoard Turbot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_special_device/setup_minnowboard_turbot.html#minnowboard-resources">MinnowBoard resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_special_device/setup_minnowboard_turbot.html#development">Development</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/setup_special_device/setup_up_2_board.html">Set up SOF on Up Squared board with Hifiberry DAC+ (STD)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_special_device/setup_up_2_board.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/setup_special_device/setup_up_2_board.html#setup-instructions">Setup Instructions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#debug-audio-issues-on-intel-platforms">Debug Audio issues on Intel platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/intel_debug/introduction.html">Overview of Intel hardware platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/introduction.html#acpi-platforms-introduced-before-and-up-to-2015">ACPI platforms (introduced before and up to 2015)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/introduction.html#pci-devices-introduced-after-2016">PCI devices (introduced after 2016)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/introduction.html#user-space-and-filesystem-requirements">User space and filesystem requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html">Suggestions before filing an SOF bug</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#run-alsa-info">Run alsa-info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#disable-sof-on-pci-hdaudio-devices-to-test-audio-playback">Disable SOF on PCI/HDaudio devices to test audio playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#try-booting-into-windows-first-then-reboot-into-linux">Try booting into Windows first, then reboot into Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#reverse-engineer-the-windows-audio-driver">Reverse-engineer the Windows audio driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#make-sure-the-me-is-enabled">Make sure the ME is enabled</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#test-at-the-alsa-hw-device-level">Test at the ALSA ‘hw’ device level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#verify-mixer-settings">Verify mixer settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#enable-dynamic-debug">Enable dynamic debug</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#install-sof-logger">Install sof-logger</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#digital-mic-issues">Digital mic issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/intel_debug/suggestions.html#es8336-support">ES8336 support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#sof-on-nxp-platforms">SOF on NXP platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html">SOF User Guide on NXP i.MX8 platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html#supported-nxp-platforms">Supported NXP platforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html#toolchain">Toolchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html#quick-run-with-sof-from-i-mx8-board-support-package">Quick run with SOF from i.MX8 Board Support Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html#build-sof-binaries-from-sources">Build SOF binaries from sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/nxp/sof_imx_user_guide.html#audio-scenarios">Audio scenarios</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html#building-loadable-modules-using-lmdk">Building loadable modules using LMDK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/loadable_modules/lmdk_user_guide.html">Loadable modules build guide using LMDK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/loadable_modules/lmdk_user_guide.html#what-is-lmdk">What is LMDK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../getting_started/loadable_modules/lmdk_user_guide.html#how-to-build">How to build</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architectures/index.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architectures/host/index.html">Host Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html">SOF Linux Driver Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#driver-probe">Driver Probe</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#sof-platform-driver">SOF Platform Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#ipc-processing">IPC Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#pcm-driver">PCM Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#power-management">Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#intel-drivers">Intel Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#support-for-high-definition-audio-hd-audio">Support for High Definition Audio (HD-Audio)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#kernel-configuration-kconfig">Kernel Configuration/Kconfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/host/linux_driver/architecture/sof_driver_arch.html#debug-options">Debug Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../architectures/firmware/index.html">Firmware Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../architectures/firmware/sof-common/index.html">SOF Common Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-common/components/index.html">Components</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../architectures/firmware/sof-xtos/index.html">SOF with XTOS Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/overview.html">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/mem-mgmt.html">Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/pm-runtime/index.html">Power Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/schedulers.html">Schedulers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/drivers/index.html">Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/pipelines/index.html">Pipelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-xtos/kd_integration/index.html">Keyword detection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/index.html">SOF with Zephyr Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/overview.html">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/app_layer/index.html">Application Layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/mpp_layer/index.html">Media Processing Pipelines Layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/rtos_layer/index.html">RTOS Layer Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/sof-zephyr/zephyr_api_integration.html">Zephyr API Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../architectures/firmware/intel/index.html">Vendor-Specific Architecture Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/intel/cavs/index.html">Intel cAVS Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../architectures/firmware/intel/ace/index.html">Intel ACE Architecture</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platforms/index.html#supported-platforms">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../platforms/index.html#minimum-platform-requirements">Minimum Platform Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/index.html#footprint">Footprint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/index.html#dsp-clock-speed">DSP Clock Speed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/index.html#toolchain">Toolchain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../platforms/index.html#platform-specific-information">Platform Specific Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/intel-legacy/index.html">Intel Hifi2-EP Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-legacy/merrifield/index.html">Intel Merrifield</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-legacy/baytrail/index.html">Intel Bay Trail / Cherry Trail</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-legacy/broadwell/index.html">Intel Broadwell</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/intel-cavs/index.html">Intel CAVS Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/commons/index.html">CAVS Commons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/apollolake/index.html">Intel Apollo Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/cannonlake/index.html">Intel Cannon Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/icelake/index.html">Intel Ice Lake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/tigerlake/index.html">Intel Tiger Lake</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Algorithms</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#supplied-processing-algorithms">Supplied Processing Algorithms</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#algorithm-specific-information">Algorithm Specific Information</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../demux/demux.html">Multiplexer/Demultiplexer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../demux/demux.html#introduction">Introduction</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Equalizers, IIR and FIR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparations">Preparations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#frequency-response-measurement">Frequency response measurement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#equalizer-design">Equalizer design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fir-equalizer">FIR equalizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iir-equalizer">IIR equalizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#combined-iir-and-fir">Combined IIR and FIR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exporting-coefficients-to-sof">Exporting coefficients to SOF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-the-response-with-sof-ctl">Testing the response with sof-ctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-eq-settings-in-topology">Using the EQ settings in topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../src/sample_rate_conversion.html">Sample Rate Conversion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../src/sample_rate_conversion.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../src/sample_rate_conversion.html#use-of-src-generator-tool">Use of SRC generator tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../src/sample_rate_conversion.html#test-the-src-component">Test the SRC component</a></li>
<li class="toctree-l4"><a class="reference internal" href="../src/sample_rate_conversion.html#polyphase-decomposition">Polyphase decomposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../src/sample_rate_conversion.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html">Time Domain Fixed Beamformer (TDFB)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#beamformer-types">Beamformer types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#microphone-array-geometries">Microphone array geometries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#filter-bank-design-procedure">Filter bank design procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#design-examples">Design examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tdfb/time_domain_fixed_beamformer.html#simulation">Simulation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/index.html">Developer Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/introduction.html">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/introduction.html#sof-core-concepts">SOF Core Concepts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/firmware/index.html">Firmware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/firmware/component-tutorial/tut-intro.html">Hello World Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/component-tutorial/tut-i-basic-fw-code.html">Part I - Adding a Component Code to FW</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/component-tutorial/tut-ii-topology.html">Part II - Modifying the Topology &amp; Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/component-tutorial/tut-iii-runtime-params.html">Part III - Adding Run-time Parameter Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/component-tutorial/tut-iv-exceptions.html">Part IV - Working with Exception Reports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/firmware/porting.html">Porting Guides</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/porting.html#architecture-porting-guide">Architecture Porting Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/porting.html#platform-porting-guide">Platform Porting Guide</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/firmware/cmake.html">CMake Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/cmake.html#firmware-unit-tests">Firmware &amp; Unit Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/cmake.html#firmware">Firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/cmake.html#unit-tests">Unit Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/cmake.html#host-testbench">Host Testbench</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html">Async Messaging Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#message-type-ids">Message Type IDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#message-handling">Message Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#processing-in-a-consumer-callback">Processing in a consumer callback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#message-filtering-mechanism">Message Filtering Mechanism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#passing-pointers-in-asynchronous-messages">Passing Pointers In Asynchronous Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#one-way-messages">One-way Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#two-way-messages-example-1">Two-way Messages - Example #1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#two-way-messages-example-2">Two-way Messages - Example #2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#max-message-size">Max message size</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/firmware/async_messaging_best_practices.html#queue-is-full">Queue is Full</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/unit_tests.html">Unit Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#configuring-for-unit-tests">Configuring for unit tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/unit_tests.html#example-running-tests-for-apl">Example: Running tests for APL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/unit_tests.html#compiling-unit-tests-without-a-cross-compilation-toolchain">Compiling unit tests without a cross-compilation toolchain</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#wrapping-objects-for-unit-tests">Wrapping objects for unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/xtrun/index.html">Xtensa Simulator (xt-run)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/xtrun/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/xtrun/index.html#standalone-programs">Standalone programs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/xtrun/index.html#unit-tests">Unit tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/topology/topology.html">SOF Topology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology/topology.html#topology-ingredients">1. Topology Ingredients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#widgets">1.1 Widgets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#tokens-vendor-tuples">1.2 Tokens/Vendor Tuples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#kcontrols">1.3 Kcontrols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#pipelines">1.4 Pipelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#backend-dai">1.5 Backend DAI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#backend-dai-link-config">1.6 Backend DAI link Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#dsp-core-index">1.7 DSP Core Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology/topology.html#create-a-new-topology">2. Create a new topology</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#example-topology-with-single-pipeline">2.1 Example topology with single pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology/topology.html#example-topology-with-multiple-pipelines">2.2 Example topology with multiple pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology/topology.html#debug-topology">3. Debug topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology/topology.html#acronyms">4. Acronyms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/topology2/topology2.html">Topology 2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#ingredients">Ingredients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#objects">Objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#arguments-in-top-level-configuration-files">Arguments in top-level configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#includes">Includes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#simple-machine-topology">Simple machine topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#conditional-includes">Conditional includes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#building-2-0-configuration-files">Building 2.0 configuration files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#topology-reminders">Topology reminders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/topology2/topology2.html#alsaconf-reminders">Alsaconf reminders</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/uuid/index.html">UUID Usage in SOF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#why-uuids">Why UUIDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#uuid-allocation">UUID allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#uuid-in-topology">UUID in topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#linux-topology-driver">Linux topology driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#uuid-arrays-stored-section">UUID arrays stored section</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#uuid-to-component-driver-mapping">UUID to component driver mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/uuid/index.html#abi-alignment-for-uuid-support">ABI alignment for UUID support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/debugability/index.html">Debugability</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/traces/index.html">Traces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/traces/index.html#building-processing-traces">Building &amp; Processing Traces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/traces/index.html#enabling-traces">Enabling Traces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/traces/index.html#adding-traces">Adding Traces</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/logger/index.html">Logger</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/logger/index.html#logger-usage">Logger usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/logger/index.html#trace-filtering">Trace filtering</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/coredump-reader/index.html">Coredump-reader</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/coredump-reader/index.html#coredump-reader-usage">Coredump-reader usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/coredump-reader/index.html#usage-with-linux-sof-driver">Usage with Linux SOF Driver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html">Probes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html#requirements">Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html#enabling-probes">Enabling Probes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html#data-extraction">Data extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html#data-parsing">Data parsing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/probes/index.html#simple-logging-case">Simple logging case</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/ri-info/index.html">sof-ri-info</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/ri-info/index.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/debugability/perf-counters/index.html">Performance Counters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/perf-counters/index.html#performance-counters-usage">Performance Counters usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/debugability/perf-counters/index.html#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/tuning/sof-ctl.html">Runtime Tuning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/tuning/sof-ctl.html#find-out-effect-numids">Find out effect numids</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/tuning/sof-ctl.html#example-equalizer-settings">Example equalizer settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/tuning/sof-ctl.html#help">Help</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/rimage/index.html">Rimage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/rimage/extended_manifest.html">Extended Manifest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/rimage/extended_manifest.html#build-flow">Build flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/rimage/extended_manifest.html#add-a-new-element">Add a new element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/rimage/index.html#build-flow">Build flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/linux_driver/index.html">SOF Linux Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/linux_driver/third_party/index.html">Third Party Features User Guides</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/linux_driver/third_party/keyword_detect/keyword_detect.html">Keyword Detection Driver Implementation and User Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html">SOF VirtIO design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#general-information">General information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#id1">SOF VirtIO design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#communication-channels">Communication channels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#topology">Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#dpcm-audio-routing">DPCM audio routing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#implementation">Implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#streaming">Streaming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/virtualization/virtualization.html#deactivation">Deactivation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/virtualization/running.html">Run SOF VirtIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#general-information">General information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#create-a-vm-image">1. Create a VM image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#build-the-linux-kernel">2. Build the Linux kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#build-qemu">3. Build QEMU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#build-the-sof-firmware">4. Build the SOF firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/virtualization/running.html#run-qemu">5. Run QEMU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/fuzzing/index.html">Fuzzing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/fuzzing/fuzzing_in_docker.html">Fuzzing in Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/fuzzing_in_docker.html#instructions">Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/fuzzing_in_docker.html#important-notes">Important notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/fuzzing/testbench_afl_fuzzing.html">Build a Fuzzing Testbench with AFL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/testbench_afl_fuzzing.html#install-afl">Install AFL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/testbench_afl_fuzzing.html#build-a-testbench-with-afl-instrumentation">Build a testbench with AFL instrumentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/testbench_afl_fuzzing.html#run-afl">Run AFL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/fuzzing/testbench_afl_fuzzing.html#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/testbench/index.html">Testbench</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/testbench/build_testbench.html">Build and Run Testbench</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/testbench/build_testbench.html#host-testbench-sh">host-testbench.sh</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/testbench/debug_in_testbench.html">Debug Component in Testbench</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/testbench/debug_in_testbench.html#gdb-and-ddd">GDB and DDD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/testbench/debug_in_testbench.html#valgrind">Valgrind</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/testbench/debug_in_testbench.html#gprof">Gprof</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/testbench/prepare_new_component.html">Prepare a New Component for Testbench</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/testbench/test_audio_quality.html">Test Audio Quality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/add_new_arch.html">Adding a new DSP architecture to SOF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/add_new_arch.html#method-1-new-hal">Method 1 - New HAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/add_new_arch.html#method-2-use-existing-rtos">Method 2 - Use existing RTOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/index.html#technical-notes">Technical Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/tech/build-cmocka.html">Build Cmocka for Xtensa</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/build-cmocka.html#cmocka-fork">Cmocka fork</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/build-cmocka.html#simple-build-on-linux">Simple build on Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/build-cmocka.html#cross-platform-build">Cross-platform build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/tech/compile_wsl.html">Build on Windows 10 with WSL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/compile_wsl.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/compile_wsl.html#enable-32-bit-binaries">Enable 32-bit binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/compile_wsl.html#fix-stat-in-32-bit-binaries">Fix stat in 32-bit binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/tech/compile_wsl.html#compile">Compile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release.html#firmware-and-tools">Firmware and Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release.html#git">Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release.html#source-and-binary-releases">Source and Binary Releases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release.html#linux-driver">Linux Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributing to the Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/contribute_guidelines.html">Contribution Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#licensing">Licensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#developer-certification-of-origin-dco">Developer Certification of Origin (DCO)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/contribute_guidelines.html#dco-sign-off-methods">DCO Sign-Off Methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/doc_guidelines.html">Documentation Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#headings">Headings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#content-highlighting">Content Highlighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#lists">Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#multi-column-lists">Multi-column lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#file-names-and-commands">File names and Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#internal-cross-reference-linking">Internal Cross-Reference Linking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#non-ascii-characters">Non-ASCII Characters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#code-and-command-examples">Code and Command Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#tabs-spaces-and-indenting">Tabs, spaces, and indenting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/dox-source-code.html">Documenting the Source Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/dox-source-code.html#basic-rules">Basic Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/dox-source-code.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/process/bug-tracking.html">Bug Tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/bug-tracking.html#life-cycle-of-a-bug">Life Cycle of a Bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/bug-tracking.html#labels">Labels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/bug-tracking.html#solution-labels">Solution Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/bug-tracking.html#priority-labels">Priority Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/bug-tracking.html#plaform-and-branch-labels">Plaform and Branch Labels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/bug-tracking.html#other-optional-labels">Other optional Labels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/bug-tracking.html#how-to-report-a-bug">How to Report a Bug</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/bug-tracking.html#how-to-close-a-bug">How to Close a Bug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/process/docbuild.html">SOF Documentation Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#documentation-overview">Documentation overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#set-up-documentation-working-folders">Set up documentation working folders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#install-documentation-tools">Install documentation tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#documentation-presentation-theme">Documentation presentation theme</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#run-documentation-processors">Run documentation processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#publish-content">Publish content</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#installation-troubleshooting">Installation troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#windows-troubleshooting">Windows troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/docbuild.html#diagram-compilation-troubleshooting">Diagram compilation troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/process/abiprocess.html">SOF ABI Change Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/abiprocess.html#sof-abi-definitions">SOF ABI definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/abiprocess.html#change-process">Change process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/abiprocess.html#document-modified-fields">Document modified fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/process/abiprocess.html#abi-change-approvers">ABI change approvers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/abiprocess.html#tsc">TSC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/process/abiprocess.html#sof-driver">SOF driver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/linux/development_tree.html">Linux SOF drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/linux/development_tree.html#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/linux/development_tree.html#instructions-for-sof-developers">Instructions for SOF developers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#abi-changes">ABI changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#development-branch">Development branch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#rebasing-tree">Rebasing tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#upstream-merges">Upstream merges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/linux/development_tree.html#development-flow">Development flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#sof-linux-maintainers">SOF Linux maintainers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/linux/development_tree.html#sof-maintainers-process">SOF maintainers process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/linux/development_tree.html#development-summary">Development summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tsc/index.html">Technical Steering Committee (TSC)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tsc/representatives.html">TSC Representatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tsc/meetings.html">TSC Meetings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainers/index.html">SOF admin, maintainers and code owners</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../maintainers/admin.html">SOF admin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../maintainers/merge_rights.html">Merge rights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../maintainers/code_owners.html">SOF code owners</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/uuid-api.html">UUID API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/dma-drivers-api.html">DMA Drivers API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/dai-drivers-api.html">DAI Drivers API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/pm-runtime-api.html">PM Runtime API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/platform-api.html">Platform API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/memory-alloc-api.html">Memory Allocation API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/audio-stream-api.html">Audio Stream API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/component-api.html">Component API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/component-ext-api.html">Component API Ext</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/uapi.html">uAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../presentations/index.html">Presentations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../presentations/index.html#sof-mentions">SOF Mentions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SOF Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Algorithms</a></li>
      <li class="breadcrumb-item active">Equalizers, IIR and FIR</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="equalizers-iir-and-fir">
<span id="equalizers-tuning"></span><h1><a class="toc-backref" href="#id27">Equalizers, IIR and FIR</a><a class="headerlink" href="#equalizers-iir-and-fir" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#equalizers-iir-and-fir" id="id27">Equalizers, IIR and FIR</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id28">Introduction</a></p></li>
<li><p><a class="reference internal" href="#preparations" id="id29">Preparations</a></p></li>
<li><p><a class="reference internal" href="#frequency-response-measurement" id="id30">Frequency response measurement</a></p></li>
<li><p><a class="reference internal" href="#equalizer-design" id="id31">Equalizer design</a></p></li>
<li><p><a class="reference internal" href="#fir-equalizer" id="id32">FIR equalizer</a></p></li>
<li><p><a class="reference internal" href="#iir-equalizer" id="id33">IIR equalizer</a></p></li>
<li><p><a class="reference internal" href="#combined-iir-and-fir" id="id34">Combined IIR and FIR</a></p></li>
<li><p><a class="reference internal" href="#exporting-coefficients-to-sof" id="id35">Exporting coefficients to SOF</a></p></li>
<li><p><a class="reference internal" href="#testing-the-response-with-sof-ctl" id="id36">Testing the response with sof-ctl</a></p></li>
<li><p><a class="reference internal" href="#using-the-eq-settings-in-topology" id="id37">Using the EQ settings in topology</a></p></li>
<li><p><a class="reference internal" href="#references" id="id38">References</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id28">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Frequency response is the system output level specific to a
frequency. It can be measured in acoustical, electrical analog, or
digital domain. Standards such as AES17 <a class="footnote-reference brackets" href="#id4" id="id1">1</a> define how it is measured
and reported.</p>
<p>The frequency response between e.g. 20 Hz and 20 kHz, that
is typical human max. range, is measured by sweeping signal generator
frequency and observing and recording the system output level into a
curve.</p>
<p>The speaker frequency responses can rarely be optimized by mechanical
and acoustical design in the mass market devices. The industrial
design and miniaturization typically limit the performance. The
non-flat frequency response is a form of linear distortion. It causes
the sound reproduction to be unnatural in a way that could be called
thin, dark, etc. Such systematic issues in speaker frequency response
can be improved with equalization.</p>
<p>Equalization is a simple technique that creates by signal processing
in an open loop pre-defined opposite linear distortion into signal to
cancel the linear distortion caused by speaker. However the cancel
cannot be perfect since the fixed equalization response need to be in
practice common for all production devices. Optimizing for one device
could cause another device to fail if the characteristic at that
frequency would differ. Hence the equalization can address only
systematic issues in the frequency response.  Also when applying
equalization the system performance is impacted. Equalization nearly
always reduces achievable peak sound pressure level (SPL) and reduces
system dynamic range (DR). When tuning the equalization the trade-offs
need to be considered.</p>
<p>The document describes speaker equalization. Microphones equalization
is similar but measurements are done in opposite domain: Acoustical -&gt;
digital. In both cases use of calibrated reference microphone is
needed.</p>
</section>
<section id="preparations">
<h2><a class="toc-backref" href="#id29">Preparations</a><a class="headerlink" href="#preparations" title="Permalink to this headline">¶</a></h2>
<p>The device should allow remote ssh without password for the automatic
scripts to work. Since the developers have usually their public and
private keys setup only this is needed. Find out the IP address from
ifconfig command output on your device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh-copy-id -i ~/.ssh/id_rsa.pub user@aa.bb.cc.dd
</pre></div>
</div>
<p>For ssh to work with low delay the development PC and tuned device
should be on the same local IP network. You can check that remote
playback works to DUT with example command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh user@aa.bb.cc.dd <span class="s2">&quot;aplay -l&quot;</span>
</pre></div>
</div>
<p>Since the tests are done with low-level ALSA aplay and arecord
utilities it is recommended to temporarily rename in DUT the audio
servers to disable them. Kill manually the processes or reboot to
avoid them continue running. The audio servers can be disabled from OS
system control in more elegant way but it is harder to remember how to
do it and restore to normal vs. the brute force way.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /usr/bin
sudo mv pulseaudio pulseaudio.disabled
sudo mv pipewire pipewire.disabled
</pre></div>
</div>
</section>
<section id="frequency-response-measurement">
<h2><a class="toc-backref" href="#id30">Frequency response measurement</a><a class="headerlink" href="#frequency-response-measurement" title="Permalink to this headline">¶</a></h2>
<p>Note: More professional audio analyzer systems are recommended to be
used for final tuning. The procedures described in this document are
for coarse initial settings. Final tuning, especially if dependence
to regulations and standards need to be done with care in professional
environment with calibrated measurement equipment.</p>
<p>To measure speakers an omnidirectional USB measurement microphone is
recommended, e.g. UMM6 <a class="footnote-reference brackets" href="#id5" id="id2">2</a> or UMIK-1 <a class="footnote-reference brackets" href="#id6" id="id3">3</a>. Such microphones are
inexpensive and do not necessarily have a flat frequency response but
the manufacturers provide a serial number based downloadable
calibration file for them. The calibration can be applied to these
measurements in SOF as well by referencing the downloaded calibration
data to measurement script.</p>
<p>Next step up are analog condenser measurement microphones with a
high-end USB sound card that can provide the 48V phantom voltage. But
analog microphones add more calibration consideration for analog
level. The measurement microphones can be also calibrated for absolute
level with dedicated microphone calibrators those can output into the
sealed compartment a reference 94 dBSPL tone.</p>
<p>The tools for measurement and EQ design are in located in directory
$SOF_WORKSPACE/sof/tools/tune/eq. The test setup is such that the DUT
device plays back the measurement wav file via ssh commands and the
development PC connected USB microphone captures the output. To
achieve this the configuration files for playback and capture need to
be edited.</p>
<p>The capture device UMM6 is hw:3.0 (card 3, device 0), this can be seen
from output of arecord command on a the development PC example. We
also know that this device supports one capture channel.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>arecord -l
**** List of CAPTURE Hardware Devices ****
card <span class="m">0</span>: PCH <span class="o">[</span>HDA Intel PCH<span class="o">]</span>, device <span class="m">0</span>: ALC257 Analog <span class="o">[</span>ALC257 Analog<span class="o">]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">1</span>: Ultra <span class="o">[</span>Fast Track Ultra<span class="o">]</span>, device <span class="m">0</span>: USB Audio <span class="o">[</span>USB Audio<span class="o">]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">2</span>: Audio <span class="o">[</span>ThinkPad Dock USB Audio<span class="o">]</span>, device <span class="m">0</span>: USB Audio <span class="o">[</span>USB Audio<span class="o">]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">3</span>: UMM6 <span class="o">[</span>UMM-6<span class="o">]</span>, device <span class="m">0</span>: USB Audio <span class="o">[</span>USB Audio<span class="o">]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
</pre></div>
</div>
<p>The settings file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat mls_rec_config.txt
%% Recording device configuration

rec.ssh <span class="o">=</span> <span class="m">0</span><span class="p">;</span>             % Set to <span class="m">1</span> <span class="k">for</span> remote capture
rec.user <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>           % Set to user@domain <span class="k">for</span> ssh
rec.dir <span class="o">=</span> <span class="s1">&#39;/tmp&#39;</span><span class="p">;</span>        % Directory <span class="k">for</span> temporary files
rec.dev <span class="o">=</span> <span class="s1">&#39;hw:3,0&#39;</span><span class="p">;</span>      % Audio capture device
rec.nch <span class="o">=</span> <span class="m">1</span><span class="p">;</span>             % Number audio capture channels to use

% Use <span class="s1">&#39;&#39;</span> <span class="k">if</span> calibration is not needed. Otherwise <span class="nb">set</span> to
% e.g. <span class="s1">&#39;1234567.txt&#39;</span>. Such calibration data format is supported <span class="k">for</span>
% some reasonably priced measurement microphones. The ASCII text
% calibration data file is the measured frequency response of the used
% microphone. Lines in the beginning those start with character <span class="s2">&quot; are</span>
<span class="s2">% treated as comment. The successive lines should be &lt;frequency&gt;</span>
<span class="s2">% &lt;magnitude&gt; number pairs. Their unit must be Hz and dB.</span>
<span class="s2">rec.cal = &#39;&#39;;</span>
</pre></div>
</div>
<p>Similarly check with remote aplay command the playback devices and
then edit the playback settings.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh user@aa.bb.cc.dd <span class="s2">&quot;aplay -l&quot;</span>
**** List of PLAYBACK Hardware Devices ****
card <span class="m">0</span>: sofglkda7219max <span class="o">[</span>sof-glkda7219max<span class="o">]</span>, device <span class="m">0</span>: Speakers <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">0</span>: sofglkda7219max <span class="o">[</span>sof-glkda7219max<span class="o">]</span>, device <span class="m">1</span>: Headset <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">0</span>: sofglkda7219max <span class="o">[</span>sof-glkda7219max<span class="o">]</span>, device <span class="m">5</span>: HDMI1 <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">0</span>: sofglkda7219max <span class="o">[</span>sof-glkda7219max<span class="o">]</span>, device <span class="m">6</span>: HDMI2 <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
card <span class="m">0</span>: sofglkda7219max <span class="o">[</span>sof-glkda7219max<span class="o">]</span>, device <span class="m">7</span>: HDMI3 <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
  Subdevices: <span class="m">1</span>/1
  Subdevice <span class="c1">#0: subdevice #0</span>
</pre></div>
</div>
<p>On the DUT the speakers are provided by device hw:0,0. It’s known that
there’s two playback channels in the device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat mls_play_config.txt
play.ssh <span class="o">=</span> <span class="m">1</span><span class="p">;</span>         % Set to use remote ssh commands
play.user <span class="o">=</span> <span class="s1">&#39;user@aa.bb.cc.dd&#39;</span><span class="p">;</span> % Set user@domain <span class="k">for</span> ssh
play.dir <span class="o">=</span> <span class="s1">&#39;/tmp&#39;</span><span class="p">;</span>    % directory <span class="k">for</span> temporary files
play.dev <span class="o">=</span> <span class="s1">&#39;hw:0,0&#39;</span><span class="p">;</span>  % Audio device <span class="k">for</span> playback
play.nch <span class="o">=</span> <span class="m">2</span><span class="p">;</span>         % Number of playback channels to <span class="nb">test</span>
</pre></div>
</div>
<p>Next the measurement orientation and measurement microphone place is
considered. A notebook could be placed on top of a table symmetrically
where the measurement microphone location should be symmetrical to
display center axis. The microphone location could be near the center
of user’s ears. If the measurement microphone capture is too silent or
disturbed by ambient noise the microphone should be placed closer into
near field.</p>
<figure class="align-default" id="id7">
<a class="reference internal image-reference" href="../../_images/Picture_speaker_meas.jpg"><img alt="../../_images/Picture_speaker_meas.jpg" src="../../_images/Picture_speaker_meas.jpg" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 99 </span><span class="caption-text">On-axis measurement position for bottom located speakers.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Since this example device is a convertible type with a near 360 degree
display hinge there are several usage orientations. It was chosen to
measure the speakers from about their firing axis. Since the response
is impacted by orientation this was felt as safest choice. It also
gave the flattest looking frequency response.</p>
<p>The MLS measurement tolerates some noise but the more silent the
environment is the better it is. An anechoic chamber would be ideal
naturally. The used MLS signal sets stress for the speakers so start
with a low volume setting with “alsamixer -Dhw:0”. Find the speaker
playback volume control PGA or volume controlin speaker amplifier and
start with e.g. 50%.</p>
<p>Start Octave and launch the measurement</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="p">=</span> <span class="n">mls_freq_resp</span><span class="p">(</span><span class="s">&#39;DUT&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>If the script warns about too silent audio increase the volume and/or
bring the microphone closer to the device. If the device has small
speakers and test signal playback sounds like at being near to their
capability limit, it is best to ignore the warning. The speakers may
permanently damage if the playback is too loud.</p>
<p>If problems the script contains a self test for quick integrity
check. The self test measures a recursive filter that simulates a
non-flat response. The measurement and theoretical response that’s
computed directly from filter coefficients should match.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="p">=</span> <span class="n">mls_freq_resp</span><span class="p">(</span><span class="s">&#39;selftest&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The test signal contains two chirps and a few times repeated
pseudo-random numbers sequence. The chirps are used to locate and
extract the MLS part. The MLS sequence has such a characteristic the
the correlation with itself is minimal. The sufficient length of the
sequence is used to suppress room reverberation from the
measurement. It provides nearly similar measured frequency responses
as achieved in anechoic conditions. As in anechoic chamber the setup
should be as much as possible like free-field. The desk/stand where
the device is measured should be away from reflecting surfaces.</p>
<p>This MLS measurement would naturally also benefit from doing in
anechoic chamber since the MLS technique cannot eliminate all reverb
impact form measurement. Though usually in chambers there’s
professional equipment available like Audio Precision ® and other. If
such are available this measurement step with SOF can be avoided and
continued from next section for data import for tuning.</p>
<figure class="align-default" id="id8">
<a class="reference internal image-reference" href="../../_images/Picture_raw_frequency_response.png"><img alt="../../_images/Picture_raw_frequency_response.png" src="../../_images/Picture_raw_frequency_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 100 </span><span class="caption-text">Frequency response measurement. The first channel is aligned to 0
dB at 1 kHz. The second channel is shown with true offset
vs. first.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>After a successful measurement a plot with frequency (Hz) and
magnitude (dB) as x and y axis will be shown. The variable f will
contain the frequency response and variable m the magnitude. If the
number of measured channels was larger than 1 the m is a matrix. The
result can be saved for equalizer design into a .mat file.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">save</span> <span class="n">example_dut</span><span class="p">.</span><span class="n">mat</span> <span class="n">f</span> <span class="n">m</span>
</pre></div>
</div>
</section>
<section id="equalizer-design">
<h2><a class="toc-backref" href="#id31">Equalizer design</a><a class="headerlink" href="#equalizer-design" title="Permalink to this headline">¶</a></h2>
<p>It can be seen from the picture that the output of speakers is weak at
below 200 Hz. There’s two resonances, first at about 700 Hz and second
at about 5 kHz (better visible on table orientation). The response is
within -10 .. +10 dB in about 300 - 13000 Hz range. The equalization
should not be applied outside these frequencies to avoid a large loss
of SPL. It can be also seen that the left and right speaker have
slightly different frequency response.</p>
<p>Next the measurement data is imported to SOF. It can be done by load
of previously saved file or importing e.g. in MS Excel format from
other equipment. The matrix columns for frequency and channel specific
levels need to be known.</p>
<p>The tool in SOF is a set of functions to be used in user created
script. Therefore programming knowledge is needed. The benefit of
using script is the procedure is easy to repeat and documented by
itself.</p>
</section>
<section id="fir-equalizer">
<h2><a class="toc-backref" href="#id32">FIR equalizer</a><a class="headerlink" href="#fir-equalizer" title="Permalink to this headline">¶</a></h2>
<p>The finite impulse response (FIR) filter type has the advantages that
design for any finite time impulse response / frequency response is
simple and robust. The filters do not oscillate by design so the
rounding errors do not appear as noise. The rounding of coefficients
into a fixed word length only impairs slightly the response but the
effect can be usually ignored. Therefore the FIR equalizers especially
when used with 24 and 32 bit audio format are compatible with studio
like 24 bit audio quality.</p>
<p>Due finite response (often limited by DSP resources) the FIR filters
are not practical for lowest frequencies unless very long filters are
used. The longer the filter is the more DSP RAM and MCPS the
processing consumes. However FIR filters are great for mid and high
frequencies equalization. The next example equalizes those frequencies
for the previously done measurement.</p>
<p>The initial script for tuning is shown below. Alternatively for other
equipment the data import could be done in Excel format and use
function xlsread(); to read a matrix and then extract the frequency
and magnitude columns.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Load measurement data, variable f and m</span>
<span class="nb">load</span> <span class="n">example_dut</span><span class="p">.</span><span class="n">mat</span><span class="p">;</span>

<span class="c">%%  EQ settings</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_defaults</span><span class="p">();</span>         <span class="c">% Get defaults</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fs</span> <span class="p">=</span> <span class="mf">48e3</span><span class="p">;</span>               <span class="c">% Set sample rate</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_type</span> <span class="p">=</span> <span class="s">&#39;loudness&#39;</span><span class="p">;</span>  <span class="c">% Normalize criteria can be loudness/peak/1k</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>       <span class="c">% Offset in dB to normalize, -3dB loudness</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_plot</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>    <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_eq</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>      <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">enable_fir</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c">% By default both FIR and IIR disabled</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_beta</span> <span class="p">=</span> <span class="mf">3.0</span><span class="p">;</span>          <span class="c">% Lower beta is more accurate but be careful</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_length</span> <span class="p">=</span> <span class="mi">90</span><span class="p">;</span>         <span class="c">% Minimize this vs. fmin/fmax choice</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_autoband</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="c">% Select manually frequency limits</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmin_fir</span> <span class="p">=</span> <span class="mi">700</span><span class="p">;</span>          <span class="c">% Equalization starts from 800 Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmax_fir</span> <span class="p">=</span> <span class="mf">13e3</span><span class="p">;</span>         <span class="c">% Equalization ends at 13 kHz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_minph</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>           <span class="c">% Check result carefully if 1 is used, 0 is safe</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">;</span>                   <span class="c">% Copy settings to second EQ</span>

<span class="c">%% Design left channel EQ</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>       <span class="c">% Measurement dB, left ch</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq1</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>The run of this script creates these plots. Note the choice of 1.0
octaves smoothing for both plotting and EQ target derivation. It’s
best to start carefully with such a high amount of smoothing to avoid
to equalize highly uncertain details of frequency response.</p>
<p>The smoothed version of the response becomes very flat in the
equalized version. However the simulated raw response still contains a
lot of ripple especially at high bands. It’s an industry standard to
use ⅓ octaves smoothing since it quite well matches human ear
psycho-acoustics. Therefore ⅓ octaves should be the smallest feasible
width of octaves smoothing to use.</p>
<figure class="align-default" id="id9">
<a class="reference internal image-reference" href="../../_images/Picture_response_with_smoothing.png"><img alt="../../_images/Picture_response_with_smoothing.png" src="../../_images/Picture_response_with_smoothing.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 101 </span><span class="caption-text">Imported frequency response with and without octaves
smoothing. Note that the strong 1.0 octaves wide smoothing
“flattens” most of the narrow (high Q) resonances and leaves the
two mentioned resonances at 700 Hz and 4 kHz.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id10">
<a class="reference internal image-reference" href="../../_images/Picture_FIR_right_channel_equalized.png"><img alt="../../_images/Picture_FIR_right_channel_equalized.png" src="../../_images/Picture_FIR_right_channel_equalized.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 102 </span><span class="caption-text">Simulated frequency response after equalization</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id11">
<a class="reference internal image-reference" href="../../_images/Picture_FIR_response.png"><img alt="../../_images/Picture_FIR_response.png" src="../../_images/Picture_FIR_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 103 </span><span class="caption-text">Frequency response of equalizer. The blue curve is the ideal
inverse response including the smoothing. The red curve is the band
limited and filter design parameters constrained actual EQ
response. The y-axis is offset in such way that 1 kHz frequency is
shifted to 0 dB. Try the impact of filter length to see how it
impacts the accuracy and find a fair compromise.</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id12">
<a class="reference internal image-reference" href="../../_images/Picture_FIR_response_absolute.png"><img alt="../../_images/Picture_FIR_response_absolute.png" src="../../_images/Picture_FIR_response_absolute.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 104 </span><span class="caption-text">Frequency response of equalizer. This curve shows the absolute gain
of the equalization. It can be seen that the normalization of
loudness (-3 dB) does some fairly high gain above 10 kHz. The
attenuation of frequencies below 200 Hz may or may not be
sufficient to give signal headroom for this boost. Need to watch
out for distortion in playback, if observed the loudness need to be
decreased.</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id13">
<a class="reference internal image-reference" href="../../_images/Picture_FIR_impulse_response.png"><img alt="../../_images/Picture_FIR_impulse_response.png" src="../../_images/Picture_FIR_impulse_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 105 </span><span class="caption-text">Impulse response of equalizer. The chosen minimum phase
non-symmetrical impulse response can be seen in the shape. A linear
phase response would have symmetrical pre- and post oscillation in
the impulse response.</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Add of right channel measurement import and EQ design is done by
adding these lines to above script.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Design right channel EQ</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>       <span class="c">% Measurement dB, right ch</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq2</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<p>The resulting EQ can be seen from these plots. If the left and right
channel results are different need to know if it is due to
non-symmetrical mechanics. If there’s designed non-symmetry it’s safe
to go ahead and design different EQ for left and right channels. If
the hardware is symmetrical then it is likely to better to equalize
e.g. average response of left and right instead.</p>
<p>Note: The left and right responses are quite similar. The mechanics &amp;
acoustics is likely symmetrical so a common EQ could be the best
choice. The average of left and right response could be suitable to
use. However in this in this case the design is done as stereo for
tutorial purpose.</p>
<figure class="align-default" id="id14">
<a class="reference internal image-reference" href="../../_images/Picture_right_channel_response.png"><img alt="../../_images/Picture_right_channel_response.png" src="../../_images/Picture_right_channel_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 106 </span><span class="caption-text">Import right channel frequency response.</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id15">
<a class="reference internal image-reference" href="../../_images/Picture_FIR_right_channel_equalized.png"><img alt="../../_images/Picture_FIR_right_channel_equalized.png" src="../../_images/Picture_FIR_right_channel_equalized.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 107 </span><span class="caption-text">Simulated  response of equalizer.</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id16">
<a class="reference internal image-reference" href="../../_images/Picture_right_channel_FIR_absolute_response.png"><img alt="../../_images/Picture_right_channel_FIR_absolute_response.png" src="../../_images/Picture_right_channel_FIR_absolute_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 108 </span><span class="caption-text">Frequency response of the right channel filter. Notice the difference to left channel filter.</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The next step is to check the stereo EQ design. The left and right
channels should as equalized have similar loudness. Since the SOF tool
currently does not add much help to multi-channel design this step
needs some additional own code.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Stereo EQ</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="n">l_ch</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq1</span><span class="p">.</span><span class="n">fir_eq_db</span><span class="p">;</span>
<span class="n">r_ch</span> <span class="p">=</span> <span class="n">eq2</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq2</span><span class="p">.</span><span class="n">fir_eq_db</span><span class="p">;</span>
<span class="nb">semilogx</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">l_ch</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">r_ch</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">100</span> <span class="mf">20e3</span> <span class="o">-</span><span class="mi">20</span> <span class="mi">10</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Magnitude (dB)&#39;</span><span class="p">);</span>

<span class="c">%% Calculate level offset at 1 - 4 kHz from RMS</span>
<span class="n">idx0</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mf">4e3</span><span class="p">);</span>
<span class="n">idx</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">idx0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e3</span><span class="p">);</span>
<span class="n">l_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">l_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="n">r_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">r_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;L ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">l_lev</span><span class="p">);</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;R ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">r_lev</span><span class="p">);</span>
<span class="n">delta_lev</span> <span class="p">=</span> <span class="n">l_lev</span><span class="o">-</span><span class="n">r_lev</span><span class="p">;</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;delta %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">delta_lev</span><span class="p">);</span>
</pre></div>
</div>
<p>The plot shows the raw data plus EQ impact. Since the offset is hard
to judge from the non-smoothed plot (the smoothed data is
unfortunately for this purpose 1 kHz, 0 dB aligned) the offset is
computed from RMS level difference in 1 - 4 kHz band. In this example
the difference was 0.2 dB. The offset is next added to right channel
align.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Design right channel EQ</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c">% Offset in dB to normalize, -3dB plus L-R</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>       <span class="c">% Measurement dB, right ch</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq2</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="../../_images/Picture_simulated_left_and_right_channel_responses.png"><img alt="../../_images/Picture_simulated_left_and_right_channel_responses.png" src="../../_images/Picture_simulated_left_and_right_channel_responses.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 109 </span><span class="caption-text">Simulated frequency responses of left and right speaker channels.</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The complete tuning script is shown below for completeness. It can be a
starting point for your own stereo speaker equalizer design case!</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Load measurement data, variable f and m</span>
<span class="nb">load</span> <span class="n">example_dut</span><span class="p">.</span><span class="n">mat</span><span class="p">;</span>

<span class="c">%%  EQ settings</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_defaults</span><span class="p">();</span>         <span class="c">% Get defaults</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fs</span> <span class="p">=</span> <span class="mf">48e3</span><span class="p">;</span>               <span class="c">% Set sample rate</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_type</span> <span class="p">=</span> <span class="s">&#39;loudness&#39;</span><span class="p">;</span>  <span class="c">% Normalize criteria can be loudness/peak/1k</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>       <span class="c">% Offset in dB to normalize, -3dB loudness</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_plot</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>    <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_eq</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>      <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">enable_fir</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c">% By default both FIR and IIR disabled</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_beta</span> <span class="p">=</span> <span class="mf">3.0</span><span class="p">;</span>          <span class="c">% Lower beta is more accurate but be careful</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_length</span> <span class="p">=</span> <span class="mi">90</span><span class="p">;</span>         <span class="c">% Minimize this vs. fmin/fmax choice</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_autoband</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="c">% Select manually frequency limits</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmin_fir</span> <span class="p">=</span> <span class="mi">700</span><span class="p">;</span>          <span class="c">% Equalization starts from 800 Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmax_fir</span> <span class="p">=</span> <span class="mf">13e3</span><span class="p">;</span>         <span class="c">% Equalization ends at 20 kHz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_minph</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>           <span class="c">% Check result carefully if 1 is used, 0 is safe</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">;</span>                   <span class="c">% Copy settings to second EQ</span>

<span class="c">%% Design left channel EQ</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>       <span class="c">% Measurement dB, left ch</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq1</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c">%% Design right channel EQ</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c">% Offset in dB to normalize, -3dB plus L-R</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>       <span class="c">% Measurement dB, right ch</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq2</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="c">%% Stereo EQ</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="n">l_ch</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq1</span><span class="p">.</span><span class="n">fir_eq_db</span><span class="p">;</span>
<span class="n">r_ch</span> <span class="p">=</span> <span class="n">eq2</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq2</span><span class="p">.</span><span class="n">fir_eq_db</span><span class="p">;</span>
<span class="nb">semilogx</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">l_ch</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">r_ch</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">100</span> <span class="mf">20e3</span> <span class="o">-</span><span class="mi">20</span> <span class="mi">10</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Magnitude (dB)&#39;</span><span class="p">);</span>

<span class="c">%% Calculate level offset at 1 - 4 kHz from RMS</span>
<span class="n">idx0</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mf">4e3</span><span class="p">);</span>
<span class="n">idx</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">idx0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e3</span><span class="p">);</span>
<span class="n">l_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">l_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="n">r_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">r_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;L ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">l_lev</span><span class="p">);</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;R ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">r_lev</span><span class="p">);</span>
<span class="n">delta_lev</span> <span class="p">=</span> <span class="n">l_lev</span><span class="o">-</span><span class="n">r_lev</span><span class="p">;</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;delta %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">delta_lev</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="iir-equalizer">
<h2><a class="toc-backref" href="#id33">IIR equalizer</a><a class="headerlink" href="#iir-equalizer" title="Permalink to this headline">¶</a></h2>
<p>Infinite impulse response (IIR) filter is the other main filter type
for equalization. Here it’s described after FIR because despite the
simpler look (much lower filter orders needed) using them needs more
expertise. An IIR design can fail fatally if not used with care and
plenty of testing. Therefore it is recommended to use simple low order
filters and do the more complex response manipulation with FIR. The
risks of IIR are in stability (unwanted loud oscillation), noise, and
loss of SNR due to scaling need. However IIR filters are great for
enhancing frequency response at lowest frequencies and generally doing
stronger adjustment.</p>
<p>The tool in SOF does not support automatic design. Instead the design
is manual with parametric first and second order blocks. The second
order blocks are called often bi-quads. The parametric blocks are
specified by their type (high-pass, low-pass, low-shelf, high-shelf,
peak/notch). The shelving and peaking filters are second order. The
high-pass and low-pass filters can be first or second order. Therefore
the parametric blocks are called with abbreviations HP1, HP2, LP1,
LP2, LS2, HS2, and PN2. All parametric blocks have a resonant
frequency parameter in Hz. The shelving filters and peaking filters
have also gain in Decibels as parameter. Finally the peaking filter
has a Q-value parameter. The higher the Q-value is the narrower is the
resonance. The syntax for describing parametric EQ is shown below:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">eq1</span><span class="p">.</span><span class="n">peq</span> <span class="p">=</span>  <span class="p">[</span> <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_HP2</span>  <span class="mi">200</span>    <span class="mi">0</span>   <span class="mi">0</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_PN2</span>  <span class="mi">750</span> <span class="o">-</span><span class="mf">5.0</span> <span class="mf">1.3</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_PN2</span> <span class="mi">5000</span> <span class="o">-</span><span class="mf">4.0</span> <span class="mf">0.6</span> <span class="p">;</span> <span class="p">...</span>
           <span class="p">];</span>
</pre></div>
</div>
<p>The example can be equalized with IIR only. First, since there is very
little output from the speaker below 200 Hz we can with second order
high-pass suppress the not audible frequencies from output. It
increases the headroom for equalization a lot since typical music and
speech content has large energy there. Then, a peaking EQ is set to
attenuate the 750 Hz region by 5 dB and Q-value 1.3 for flatter
response. Finally, a peaking filter is set to attenuate the wide bump
at 5 kHz by 4 dB and Q-value 0.6. The resulting EQ is 6th order. It
also could be possible to boost the low frequencies at 400 Hz a bit
with a low-shelf but it is not done here to keep filter order
low. Boost at low frequencies creates risk for signal clipping while
the achievable bandwidth extension is not large.</p>
<figure class="align-default" id="id18">
<a class="reference internal image-reference" href="../../_images/Picture_imported_frequency_response_for_iir.png"><img alt="../../_images/Picture_imported_frequency_response_for_iir.png" src="../../_images/Picture_imported_frequency_response_for_iir.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 110 </span><span class="caption-text">Simulated frequency response. The difference in parametric
low-order IIR can be seen as more remaining small ripple in the
smoothed equalized response vs. FIR.</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id19">
<a class="reference internal image-reference" href="../../_images/Picture_iir_filter_response_vs_ideal_target.png"><img alt="../../_images/Picture_iir_filter_response_vs_ideal_target.png" src="../../_images/Picture_iir_filter_response_vs_ideal_target.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 111 </span><span class="caption-text">IIR filter response vs. ideal target.</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id20">
<a class="reference internal image-reference" href="../../_images/Picture_iir_absolute_response.png"><img alt="../../_images/Picture_iir_absolute_response.png" src="../../_images/Picture_iir_absolute_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 112 </span><span class="caption-text">Absolute response. The loudness normalize suggests a fairly high
gain for the filter since a lot of loudness is lost due to suppress
of lowest frequencies. Need to be careful with this.</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id21">
<a class="reference internal image-reference" href="../../_images/Picture_iir_poles_and_zeros.png"><img alt="../../_images/Picture_iir_poles_and_zeros.png" src="../../_images/Picture_iir_poles_and_zeros.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 113 </span><span class="caption-text">Poles and zeros plot. In recursive filters the poles (x) need to be
inside unit circle for stable design. This plot is for 64 bit float
coefficients, fixed scaled coefficients could have issues even if
this looks OK.</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id22">
<a class="reference internal image-reference" href="../../_images/Picture_iir_impulse_response.png"><img alt="../../_images/Picture_iir_impulse_response.png" src="../../_images/Picture_iir_impulse_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 114 </span><span class="caption-text">Impulse response. The main purpose of this to do another stability
check. A stable filter decays to zero while an unstable design
might remain oscillation at steady or increasing amplitude.</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The right channel is tuned similarly. The resulting non-smoothed
left/right balance corrected responses and the complete code for
tuning are shown below.</p>
<figure class="align-default" id="id23">
<a class="reference internal image-reference" href="../../_images/Picture_iir_simulated_left_and_channel_responses.png"><img alt="../../_images/Picture_iir_simulated_left_and_channel_responses.png" src="../../_images/Picture_iir_simulated_left_and_channel_responses.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 115 </span><span class="caption-text">Simulated frequency responses of left and right speakers with
IIR equalizer.</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Load measurement data, variable f and m</span>
<span class="nb">load</span> <span class="n">example_dut</span><span class="p">.</span><span class="n">mat</span><span class="p">;</span>

<span class="c">%%  EQ settings</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_defaults</span><span class="p">();</span>         <span class="c">% Get defaults</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fs</span> <span class="p">=</span> <span class="mf">48e3</span><span class="p">;</span>               <span class="c">% Set sample rate</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_type</span> <span class="p">=</span> <span class="s">&#39;loudness&#39;</span><span class="p">;</span>  <span class="c">% Normalize criteria can be loudness/peak/1k</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>       <span class="c">% Offset in dB to normalize, -3 dB loudness</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_plot</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>    <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_eq</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>      <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">enable_iir</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c">% By default both FIR and IIR disabled</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">;</span>                   <span class="c">% Copy settings to second EQ</span>

<span class="c">%% Design left channel EQ</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>       <span class="c">% Measurement dB, left ch</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">peq</span> <span class="p">=</span>  <span class="p">[</span> <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_HP2</span>  <span class="mi">200</span>    <span class="mi">0</span>   <span class="mi">0</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_PN2</span>  <span class="mi">750</span> <span class="o">-</span><span class="mf">5.0</span> <span class="mf">1.3</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_PN2</span> <span class="mi">5000</span> <span class="o">-</span><span class="mf">4.0</span> <span class="mf">0.6</span> <span class="p">;</span> <span class="p">...</span>
<span class="p">];</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq1</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c">%% Design right channel EQ</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c">% Offset in dB to normalize, -3dB plus L-R</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>       <span class="c">% Measurement dB, right ch</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">peq</span> <span class="p">=</span>  <span class="p">[</span> <span class="n">eq2</span><span class="p">.</span><span class="n">PEQ_HP2</span>  <span class="mi">200</span>    <span class="mi">0</span>   <span class="mi">0</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq2</span><span class="p">.</span><span class="n">PEQ_PN2</span>  <span class="mi">750</span> <span class="o">-</span><span class="mf">5.0</span> <span class="mf">1.4</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq2</span><span class="p">.</span><span class="n">PEQ_PN2</span> <span class="mi">4500</span> <span class="o">-</span><span class="mf">4.0</span> <span class="mf">0.6</span> <span class="p">;</span> <span class="p">...</span>
<span class="p">];</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq2</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="c">%% Stereo EQ</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="n">l_ch</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq1</span><span class="p">.</span><span class="n">iir_eq_db</span><span class="p">;</span>
<span class="n">r_ch</span> <span class="p">=</span> <span class="n">eq2</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq2</span><span class="p">.</span><span class="n">iir_eq_db</span><span class="p">;</span>
<span class="nb">semilogx</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">l_ch</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">r_ch</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">100</span> <span class="mf">20e3</span> <span class="o">-</span><span class="mi">20</span> <span class="mi">20</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Magnitude (dB)&#39;</span><span class="p">);</span>

<span class="c">%% Calculate level offset at 1 - 4 kHz from RMS</span>
<span class="n">idx0</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mf">4e3</span><span class="p">);</span>
<span class="n">idx</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">idx0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e3</span><span class="p">);</span>
<span class="n">l_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">l_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="n">r_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">r_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;L ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">l_lev</span><span class="p">);</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;R ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">r_lev</span><span class="p">);</span>
<span class="n">delta_lev</span> <span class="p">=</span> <span class="n">l_lev</span><span class="o">-</span><span class="n">r_lev</span><span class="p">;</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;delta %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">delta_lev</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="combined-iir-and-fir">
<h2><a class="toc-backref" href="#id34">Combined IIR and FIR</a><a class="headerlink" href="#combined-iir-and-fir" title="Permalink to this headline">¶</a></h2>
<p>The EQ tool can support use of both types simultaneously. The IIR type
is applied first and the impact is subtracted from the target. This
allows the FIR to fine tune the response where IIR could not match
fully the target.</p>
<p>For this example the IIR high shelf is left out because FIR can do it
efficiently. Instead of boosting at 2 kHz this script tests
attenuation at 700 Hz to flatten and extend a bit the flat frequency
response region down.</p>
<p>Note: In current version the norm_offs_db parameter impacts both FIR
and IIR part by the given amount. Therefore the level adjust need to
be entered as 0.5*adjust.</p>
<figure class="align-default" id="id24">
<a class="reference internal image-reference" href="../../_images/Picture_IIR_FIR_target_vs_achieved_response.png"><img alt="../../_images/Picture_IIR_FIR_target_vs_achieved_response.png" src="../../_images/Picture_IIR_FIR_target_vs_achieved_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 116 </span><span class="caption-text">Right channel equalization filters. The red solid plot is the combined IIR and FIR response
that matches well the smoothed target response in solid blue. The dashed yellow and purple
lines show the IIR and FIR responses.</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id25">
<a class="reference internal image-reference" href="../../_images/Picture_simulated_IIR_FIR_frequency_response.png"><img alt="../../_images/Picture_simulated_IIR_FIR_frequency_response.png" src="../../_images/Picture_simulated_IIR_FIR_frequency_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 117 </span><span class="caption-text">Simulated raw frequency response</span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="exporting-coefficients-to-sof">
<h2><a class="toc-backref" href="#id35">Exporting coefficients to SOF</a><a class="headerlink" href="#exporting-coefficients-to-sof" title="Permalink to this headline">¶</a></h2>
<p>The coefficients can be exported into a format for m4 topology for
automatic boot time setup. The topology file can include the m4
scripts instead of the default “flat” response coefficients. It is
also possible to set up an equalizer with .txt or .bin format blob in
device run-time with sof-ctl utility to test the response and iterate
the design.</p>
<p>The complete script for equalizers tuning and coefficients export for
the previous example is shown below.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%% Load measurement data, variable f and m</span>
<span class="nb">load</span> <span class="n">example_dut</span><span class="p">.</span><span class="n">mat</span><span class="p">;</span>

<span class="c">%%  EQ settings</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_defaults</span><span class="p">();</span>         <span class="c">% Get defaults</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fs</span> <span class="p">=</span> <span class="mf">48e3</span><span class="p">;</span>               <span class="c">% Set sample rate</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_type</span> <span class="p">=</span> <span class="s">&#39;loudness&#39;</span><span class="p">;</span>  <span class="c">% Normalize criteria can be loudness/peak/1k</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>       <span class="c">% Offset in dB to normalize, -3dB loudness</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_plot</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>    <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">logsmooth_eq</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>      <span class="c">% Smooth over 1.0 octaves</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">enable_fir</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c">% By default both FIR and IIR disabled</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">enable_iir</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>          <span class="c">% Enable too</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_beta</span> <span class="p">=</span> <span class="mf">3.0</span><span class="p">;</span>          <span class="c">% Lower beta is more accurate but be careful</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_length</span> <span class="p">=</span> <span class="mi">40</span><span class="p">;</span>         <span class="c">% Minimize this vs. fmin/fmax choice</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_autoband</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="c">% Select manually frequency limits</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmin_fir</span> <span class="p">=</span> <span class="mi">700</span><span class="p">;</span>          <span class="c">% Equalization starts from 800 Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fmax_fir</span> <span class="p">=</span> <span class="mf">13e3</span><span class="p">;</span>         <span class="c">% Equalization ends at 13 kHz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">fir_minph</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>           <span class="c">% Check result carefully if 1 is used, 0 is safe</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">;</span>                   <span class="c">% Copy settings to second EQ</span>

<span class="c">%% Design left channel EQ</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>       <span class="c">% Measurement dB, left ch</span>
<span class="n">eq1</span><span class="p">.</span><span class="n">peq</span> <span class="p">=</span>  <span class="p">[</span> <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_HP2</span> <span class="mi">200</span>    <span class="mi">0</span>   <span class="mi">0</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq1</span><span class="p">.</span><span class="n">PEQ_PN2</span> <span class="mi">750</span> <span class="o">-</span><span class="mf">5.0</span> <span class="mf">1.3</span> <span class="p">;</span> <span class="p">...</span>
<span class="p">];</span>
<span class="n">eq1</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq1</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c">%% Design right channel EQ</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">norm_offs_db</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c">% Offset in dB to normalize, -4dB plus L-R</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_f</span> <span class="p">=</span> <span class="n">f</span><span class="p">;</span>               <span class="c">% Measurement Hz</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">raw_m_db</span> <span class="p">=</span> <span class="n">m</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>       <span class="c">% Measurement dB, right ch</span>
<span class="n">eq2</span><span class="p">.</span><span class="n">peq</span> <span class="p">=</span>  <span class="p">[</span> <span class="n">eq2</span><span class="p">.</span><span class="n">PEQ_HP2</span> <span class="mi">200</span>    <span class="mi">0</span>   <span class="mi">0</span> <span class="p">;</span> <span class="p">...</span>
             <span class="n">eq2</span><span class="p">.</span><span class="n">PEQ_PN2</span> <span class="mi">750</span> <span class="o">-</span><span class="mf">5.0</span> <span class="mf">1.4</span> <span class="p">;</span> <span class="p">...</span>
<span class="p">];</span>
<span class="n">eq2</span> <span class="p">=</span> <span class="n">eq_compute</span><span class="p">(</span><span class="n">eq2</span><span class="p">);</span>
<span class="n">eq_plot</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="c">%% Stereo EQ</span>
<span class="nb">figure</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="n">l_ch</span> <span class="p">=</span> <span class="n">eq1</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq1</span><span class="p">.</span><span class="n">tot_eq_db</span><span class="p">;</span>
<span class="n">r_ch</span> <span class="p">=</span> <span class="n">eq2</span><span class="p">.</span><span class="n">m_db</span><span class="o">+</span><span class="n">eq2</span><span class="p">.</span><span class="n">tot_eq_db</span><span class="p">;</span>
<span class="nb">semilogx</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">l_ch</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">r_ch</span><span class="p">);</span>
<span class="nb">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="nb">axis</span><span class="p">([</span><span class="mi">100</span> <span class="mf">20e3</span> <span class="o">-</span><span class="mi">20</span> <span class="mi">10</span><span class="p">]);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">);</span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Magnitude (dB)&#39;</span><span class="p">);</span>

<span class="c">%% Calculate level offset at 1 - 4 kHz from RMS</span>
<span class="n">idx0</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mf">4e3</span><span class="p">);</span>
<span class="n">idx</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="n">idx0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e3</span><span class="p">);</span>
<span class="n">l_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">l_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="n">r_lev</span> <span class="p">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">mean</span><span class="p">(</span><span class="mf">10.</span>^<span class="p">(</span><span class="n">r_ch</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))));</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;L ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">l_lev</span><span class="p">);</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;R ch level %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">r_lev</span><span class="p">);</span>
<span class="n">delta_lev</span> <span class="p">=</span> <span class="n">l_lev</span><span class="o">-</span><span class="n">r_lev</span><span class="p">;</span>
<span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;delta %3.1f dB\n&#39;</span><span class="p">,</span> <span class="n">delta_lev</span><span class="p">);</span>

<span class="c">%% Export FIR</span>
<span class="n">fir_ascii_fn</span> <span class="p">=</span> <span class="s">&#39;dut_spk_fir.txt&#39;</span><span class="p">;</span>
<span class="n">fir_tplg_fn</span> <span class="p">=</span> <span class="s">&#39;dut_spk_fir.m4&#39;</span><span class="p">;</span>
<span class="n">fir_eq1_quant</span> <span class="p">=</span> <span class="n">eq_fir_blob_quant</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">b_fir</span><span class="p">);</span>
<span class="n">fir_eq2_quant</span> <span class="p">=</span> <span class="n">eq_fir_blob_quant</span><span class="p">(</span><span class="n">eq2</span><span class="p">.</span><span class="n">b_fir</span><span class="p">);</span>
<span class="n">channels_in_config</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>    <span class="c">% Setup max 2 channels EQ</span>
<span class="n">assign_response</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">];</span>   <span class="c">% Switch to response #0 and #1</span>
<span class="n">num_responses</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>         <span class="c">% Two responses</span>
<span class="n">fir_bm</span> <span class="p">=</span> <span class="n">eq_fir_blob_merge</span><span class="p">(</span><span class="n">channels_in_config</span><span class="p">,</span> <span class="p">...</span>
<span class="n">num_responses</span><span class="p">,</span> <span class="p">...</span>
<span class="n">assign_response</span><span class="p">,</span> <span class="p">...</span>
<span class="p">[</span><span class="n">fir_eq1_quant</span> <span class="n">fir_eq2_quant</span><span class="p">]);</span>
<span class="n">fir_bp</span> <span class="p">=</span> <span class="n">eq_fir_blob_pack</span><span class="p">(</span><span class="n">fir_bm</span><span class="p">);</span>
<span class="n">eq_alsactl_write</span><span class="p">(</span><span class="n">fir_ascii_fn</span><span class="p">,</span> <span class="n">fir_bp</span><span class="p">);</span>
<span class="n">eq_tplg_write</span><span class="p">(</span><span class="n">fir_tplg_fn</span><span class="p">,</span> <span class="n">fir_bp</span><span class="p">,</span> <span class="s">&#39;FIR&#39;</span><span class="p">);</span>

<span class="c">%% Export IIR</span>
<span class="n">iir_ascii_fn</span> <span class="p">=</span> <span class="s">&#39;dut_spk_iir.txt&#39;</span><span class="p">;</span>
<span class="n">iir_tplg_fn</span> <span class="p">=</span> <span class="s">&#39;dut_spk_iir.m4&#39;</span><span class="p">;</span>
<span class="n">iir_eq1_quant</span> <span class="p">=</span> <span class="n">eq_iir_blob_quant</span><span class="p">(</span><span class="n">eq1</span><span class="p">.</span><span class="n">p_z</span><span class="p">,</span> <span class="n">eq1</span><span class="p">.</span><span class="n">p_p</span><span class="p">,</span> <span class="n">eq1</span><span class="p">.</span><span class="n">p_k</span><span class="p">);</span>
<span class="n">iir_eq2_quant</span> <span class="p">=</span> <span class="n">eq_iir_blob_quant</span><span class="p">(</span><span class="n">eq2</span><span class="p">.</span><span class="n">p_z</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">p_p</span><span class="p">,</span> <span class="n">eq2</span><span class="p">.</span><span class="n">p_k</span><span class="p">);</span>
<span class="n">iir_bm</span> <span class="p">=</span> <span class="n">eq_iir_blob_merge</span><span class="p">(</span><span class="n">channels_in_config</span><span class="p">,</span> <span class="p">...</span>
<span class="n">num_responses</span><span class="p">,</span> <span class="p">...</span>
<span class="n">assign_response</span><span class="p">,</span> <span class="p">...</span>
<span class="p">[</span><span class="n">iir_eq1_quant</span> <span class="n">iir_eq2_quant</span><span class="p">]);</span>
<span class="n">iir_bp</span> <span class="p">=</span> <span class="n">eq_iir_blob_pack</span><span class="p">(</span><span class="n">iir_bm</span><span class="p">);</span>
<span class="n">eq_alsactl_write</span><span class="p">(</span><span class="n">iir_ascii_fn</span><span class="p">,</span> <span class="n">iir_bp</span><span class="p">);</span>
<span class="n">eq_tplg_write</span><span class="p">(</span><span class="n">iir_tplg_fn</span><span class="p">,</span> <span class="n">iir_bp</span><span class="p">,</span> <span class="s">&#39;IIR&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="testing-the-response-with-sof-ctl">
<h2><a class="toc-backref" href="#id36">Testing the response with sof-ctl</a><a class="headerlink" href="#testing-the-response-with-sof-ctl" title="Permalink to this headline">¶</a></h2>
<p>The sof-ctl tool is practical for testing new EQ settings and iterate
the design without need to reboot the device. The pre-requisite is that
the DUT runs for speaker path a topology that contains the IIR and FIR
equalizers.</p>
<p>First the numids of the equalizers are found out with amixer
command. The lines with prompt $ are user entered commands and other
text shown is command output.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ amixer -Dhw:0 controls <span class="p">|</span> grep EQIIR
<span class="nv">numid</span><span class="o">=</span><span class="m">66</span>,iface<span class="o">=</span>MIXER,name<span class="o">=</span><span class="s1">&#39;EQIIR1.0 EQIIR&#39;</span>

$ amixer -Dhw:0 controls <span class="p">|</span> grep EQFIR
<span class="nv">numid</span><span class="o">=</span><span class="m">67</span>,iface<span class="o">=</span>MIXER,name<span class="o">=</span><span class="s1">&#39;EQFIR1.0 EQFIR&#39;</span>
</pre></div>
</div>
<p>The numids are in this device 66 and 67 for IIR and FIR. Next the
exported ALSA binary controls are passed to equalizers with sof-ctl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./sof-eqctl -n <span class="m">66</span> -s dut_spk_iir.txt
Applying configuration <span class="s2">&quot;dut_spk_iir.txt&quot;</span> into device hw:0 control <span class="nv">numid</span><span class="o">=</span><span class="m">66</span>.

<span class="m">4607827</span>,0,196,50331648,0,0,0,0,196,2,2,0,0,0,0,0,1,2,2,0,0,0,0,3260252783,2107733822,
<span class="m">528275171</span>,3238416955,528275171,0,16384,3324016838,2034846530,497901563,3275128193,
<span class="m">526872106</span>,4294967293,20454,2,2,0,0,0,0,3260252783,2107733822,528275171,3238416955,
<span class="m">528275171</span>,0,16384,3317002057,2041827532,500647939,3271629404,527641448,4294967293,20551

Success.

$ ./sof-eqctl -n <span class="m">67</span> -s dut_spk_fir.txt
Applying configuration <span class="s2">&quot;dut_spk_fir.txt&quot;</span> into device hw:0 control <span class="nv">numid</span><span class="o">=</span><span class="m">67</span>.

<span class="m">4607827</span>,0,244,50331648,0,0,0,0,244,131074,0,0,0,0,65536,44,0,0,0,0,3801503801,233243489,
<span class="m">4293068324</span>,74908123,1901269,7733144,6422742,4290772934,17039467,1114313,4293328827,
<span class="m">4291756033</span>,4289658785,4291297224,4293459912,589833,4294115318,4294246391,4294442989,
<span class="m">1310731</span>,13,0,44,0,0,0,0,3785054386,221118972,13436579,74515002,8520459,10551247,10944817,
<span class="m">4292018112</span>,23789790,4291559609,4293984167,4288479207,4290576265,4293394406,131047,1179673,
<span class="m">4293853177</span>,4293853167,4294901744,851980,6,0

Success.
</pre></div>
</div>
<figure class="align-default" id="id26">
<a class="reference internal image-reference" href="../../_images/Picture_tested_speaker_frequency_response.png"><img alt="../../_images/Picture_tested_speaker_frequency_response.png" src="../../_images/Picture_tested_speaker_frequency_response.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Figure 118 </span><span class="caption-text">The response is simple to test acoustically by re-running
mls_freq_resp(); The overall response is now much more flat and is
very similar to previously shown simulated response.</span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="using-the-eq-settings-in-topology">
<h2><a class="toc-backref" href="#id37">Using the EQ settings in topology</a><a class="headerlink" href="#using-the-eq-settings-in-topology" title="Permalink to this headline">¶</a></h2>
<p>The generated .m4 suffix files for FIR and IIR can be included or
embedded into topology m4 scripts. There are a few examples of such
topologies in $SOF_WORKSPACE/sof/tools/topology/topology1/development.
The CMakeLists.txt file builds e.g. topologies
sof-cml-rt1011-rt5682-eq.tplg and sof-hda-generic-2ch-loud.tplg those
can be used as example.</p>
<p>The playback pipeline is set with -DSPKPROC=eq-iir-eq-fir-volume
or -DHSPROC=eq-iir-eq-fir-volume to contain the equalizers and volume
control components. The macros -DHSPROC_FILTER1=eq_iir_coef_pass.m4
and -DHSPROC_FILTER2=eq_fir_coef_pass.m4 are flat default responses.</p>
<p>Setting -DHSPROC_FILTER1=dut_spk_iir.m4 and
-DHSPROC_FILTER2=dut_spk_fir.m4 would set the just exported equalizer
tuning to be applied at device boot.</p>
<p>Note: Unfortunately the SOF topology1 equalizers definitions at top
CMakeLists.txt are not very systematic and there may be bugs with some
platforms triggered by small topology changes. The new topology needs
extensive testing for all audio endpoints (that other existing filters
are not modified) and preferably manual inspection of topology .conf
file that the m4 parsed output matches expectation.</p>
<p>The development now focuses to to topology2 and hopefully this part
can be cleaned up and made easier for product audio tuning.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id38">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>AES17-2020: AES standard method for digital audio engineering - Measurement of digital audio equipment,
<a class="reference external" href="https://www.aes.org/publications/standards/search.cfm?docID=21">https://www.aes.org/publications/standards/search.cfm?docID=21</a></p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Dayton audio UMM-6 USB measurement microphone,
<a class="reference external" href="https://www.daytonaudio.com/product/1116/umm-6-usb-measurement-microphone">https://www.daytonaudio.com/product/1116/umm-6-usb-measurement-microphone</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>MiniDSP UMIK-1 USB measurement microphone,
<a class="reference external" href="https://www.minidsp.com/products/acoustic-measurement/umik-1">https://www.minidsp.com/products/acoustic-measurement/umik-1</a></p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, SOF Project.
      <span class="lastupdated">Last updated on Jun 29, 2023.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M4BL5NF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'GTM-M4BL5NF', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>